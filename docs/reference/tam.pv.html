<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plausible Value Imputation — tam.pv • TAM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Plausible Value Imputation — tam.pv"><meta property="og:description" content="Plausible value imputation for objects of the classes tam and tam.mml
(Adams &amp;amp; Wu, 2007). For converting generated plausible values into
a list of multiply imputed datasets see tampv2datalist
and the Examples 2 and 3 of this function.
The function tam.pv.mcmc employs fully Bayesian estimation for drawing
plausible values and is recommended in cases when the latent regression model
is unreliably estimated (multidimensional model with stochastic nodes).
The parameters of the latent regression (regression coefficients and
residual covariance matrices) are drawn by Bayesian bootstrap (Rubin, 1981).
Either case probabilities (i.e., non-integer weights for cases in resampling;
argument sample_integers=FALSE) or ordinary
bootstrap (i.e., sampling cases with replacement; argument sample_integers=TRUE)
can be used for the Bootstrap step by obtaining posterior draws of regression parameters."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.3</span
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/alexanderrobitzsch/TAM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plausible Value Imputation</h1>
    
    <div class="hidden name"><code>tam.pv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Plausible value imputation for objects of the classes <code>tam</code> and <code>tam.mml</code>
(Adams &amp; Wu, 2007). For converting generated plausible values into
a list of multiply imputed datasets see <code><a href="tampv2datalist.html">tampv2datalist</a></code>
and the Examples 2 and 3 of this function.</p>
<p>The function <code>tam.pv.mcmc</code> employs fully Bayesian estimation for drawing
plausible values and is recommended in cases when the latent regression model
is unreliably estimated (multidimensional model with stochastic nodes).
The parameters of the latent regression (regression coefficients and
residual covariance matrices) are drawn by Bayesian bootstrap (Rubin, 1981).
Either case probabilities (i.e., non-integer weights for cases in resampling;
argument <code>sample_integers=FALSE</code>) or ordinary
bootstrap (i.e., sampling cases with replacement; argument <code>sample_integers=TRUE</code>)
can be used for the Bootstrap step by obtaining posterior draws of regression parameters.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tam.pv</span><span class="op">(</span><span class="va">tamobj</span>, nplausible<span class="op">=</span><span class="fl">10</span>, ntheta<span class="op">=</span><span class="fl">2000</span>, normal.approx<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>    samp.regr<span class="op">=</span><span class="cn">FALSE</span>, theta.model<span class="op">=</span><span class="cn">FALSE</span>, np.adj<span class="op">=</span><span class="fl">8</span>, na.grid<span class="op">=</span><span class="fl">5</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> <span class="va">tamobj</span>, Y<span class="op">=</span><span class="cn">NULL</span>, group<span class="op">=</span><span class="cn">NULL</span>, beta_groups<span class="op">=</span><span class="cn">TRUE</span>, nplausible<span class="op">=</span><span class="fl">10</span>, level<span class="op">=</span><span class="fl">.95</span>,</span>
<span>    n.iter<span class="op">=</span><span class="fl">1000</span>, n.burnin<span class="op">=</span><span class="fl">500</span>, adj_MH<span class="op">=</span><span class="fl">.5</span>, adj_change_MH<span class="op">=</span><span class="fl">.05</span>, refresh_MH<span class="op">=</span><span class="fl">50</span>,</span>
<span>    accrate_bound_MH<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.45</span>, <span class="fl">.55</span><span class="op">)</span>, sample_integers<span class="op">=</span><span class="cn">FALSE</span>, theta_init<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>    print_iter<span class="op">=</span><span class="fl">20</span>, verbose<span class="op">=</span><span class="cn">TRUE</span>, calc_ic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for tam.pv.mcmc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, file<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for tam.pv.mcmc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>tamobj</dt>
<dd><p>Object of class <code>tam</code> or <code>tam.mml</code>. For <code>tam.pv.mcmc</code>, it must not
     be an object of this class but rather a list with (at least the)
     entries <code>AXsi</code>, <code>B</code>, <code>resp</code>.</p></dd>

 <dt>nplausible</dt>
<dd><p>Number of plausible values to be drawn</p></dd>

<dt>ntheta</dt>
<dd><p>Number of ability nodes for plausible value imputation. Note
    that in this function ability nodes are simulated for the
    whole sample, not for every person (contrary to the software ConQuest).</p></dd>

  <dt>normal.approx</dt>
<dd><p>An optional logical indicating whether the individual posterior distributions
     should be approximated by a normal distribution?
     The default is <code>FALSE</code>. In the case <code>normal.approx=TRUE</code>
     (normal distribution approximation), the number of ability nodes
     <code>ntheta</code> can be substantially smaller than 2000, say 200 or 500.
     The normal approximation is implemented for unidimensional and
     multidimensional models.</p></dd>

  <dt>samp.regr</dt>
<dd><p>An optional logical indicating whether regression coefficients
     should be fixed in the plausible value imputation or
     also sampled from their posterior distribution?
     The default is <code>FALSE</code>. Sampled regression coefficients are
     obtained by nonparametric bootstrap.</p></dd>

<dt>theta.model</dt>
<dd><p>Logical indicating whether the theta grid from the
    <code>tamobj</code> object should be used for plausible value
    imputation. In case of <code>normal.approx=TRUE</code>, this should
    be sufficient in many applications.</p></dd>

  <dt>np.adj</dt>
<dd><p>This parameter defines the "spread" of the random theta values
     for drawing plausible values when <code>normal.approx=FALSE</code>.
     If \(s_{EAP}\) denotes the standard deviation of the posterior
     distribution of theta (in the one-dimensional case), then theta
     is simulated from a normal distribution with standard deviation
     <code>np.adj</code> times \(s_{EAP}\).</p></dd>

<dt>na.grid</dt>
<dd><p>Range of the grid in normal approximation. Default is from
-5 to 5.</p></dd>

<dt>...</dt>
<dd><p>Further arguments to be passed</p></dd>

<dt>Y</dt>
<dd><p>Optional matrix of regressors</p></dd>

<dt>group</dt>
<dd><p>Optional vector of group identifiers</p></dd>

<dt>beta_groups</dt>
<dd><p>Logical indicating whether group specific beta coefficients
   shall be estimated.</p></dd>

<dt>level</dt>
<dd><p>Confidence level</p></dd>

<dt>n.iter</dt>
<dd><p>Number of iterations</p></dd>

<dt>n.burnin</dt>
<dd><p>Number of burnin-iterations</p></dd>

<dt>adj_MH</dt>
<dd><p>Adjustment factor for Metropolis-Hastings (MH) steps which controls
    the variance of the proposal distribution for \(\theta\). Can be also
    a vector of length equal to the number of persons.</p></dd>

<dt>adj_change_MH</dt>
<dd><p>Allowed change for MH adjustment factor after refreshing</p></dd>

<dt>refresh_MH</dt>
<dd><p>Number of iterations after which the variance of the proposal
 distribution should be updated</p></dd>

<dt>accrate_bound_MH</dt>
<dd><p>Bounds for target acceptance rates of sampled \(\theta\)
   values.</p></dd>

<dt>sample_integers</dt>
<dd><p>Logical indicating whether weights for complete cases
should be sampled in bootstrap</p></dd>

<dt>theta_init</dt>
<dd><p>Optional matrix with initial \(\bold{\theta}\) values</p></dd>

<dt>print_iter</dt>
<dd><p>Print iteration progress every <code>print_iter</code>th iteration</p></dd>

<dt>verbose</dt>
<dd><p>Logical indicating whether iteration progress should be displayed.</p></dd>

<dt>calc_ic</dt>
<dd><p>Logical indicating whether information criteria should be computed.</p></dd>

<dt>object</dt>
<dd><p>Object of class <code>tam.pv.mcmc</code></p></dd>

<dt>x</dt>
<dd><p>Object of class <code>tam.pv.mcmc</code></p></dd>

<dt>file</dt>
<dd><p>A file name in which the summary output will be written</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The value of <code>tam.pv</code> is a list with following entries:</p>
<dl><dt>pv</dt>
<dd><p>A data frame containing a person identifier (<code>pid</code>)
    and plausible values denoted by <code>PVxx.Dimyy</code> which
    is the <code>xx</code>th plausible value of
    dimension <code>yy</code>.</p></dd>

  <dt>hwt</dt>
<dd><p>Individual posterior distribution evaluated at
    the ability grid <code>theta</code></p></dd>

  <dt>hwt1</dt>
<dd><p>Cumulated individual posterior distribution</p></dd>

  <dt>theta</dt>
<dd><p>Simulated ability nodes</p></dd>


</dl><p>The value of <code>tam.pv.mcmc</code> is a list containing entries</p>
<dl><dt>pv</dt>
<dd><p>Data frame containing plausible values</p></dd>

<dt>parameter_samples</dt>
<dd><p>Sampled regression parameters</p></dd>

<dt>ic</dt>
<dd><p>Information criteria</p></dd>

<dt>beta</dt>
<dd><p>Estimate of regression parameters \(\bold{\beta}\)</p></dd>

<dt>variance</dt>
<dd><p>Estimate of residual variance matrix \(\bold{\Sigma}\)</p></dd>

<dt>correlation</dt>
<dd><p>Estimate of residual correlation matrix corresponding to
<code>variance</code></p></dd>

<dt>theta_acceptance_MH</dt>
<dd><p>Acceptance rates and acceptance MH factors for each
individual</p></dd>

<dt>theta_last</dt>
<dd><p>Last sampled \(\bold{\theta}\) value</p></dd>

<dt>...</dt>
<dd><p>Further values</p></dd>

</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Adams, R. J., &amp; Wu, M. L. (2007). The mixed-coefficients multinomial logit model.
A generalized form of the Rasch model. In M. von Davier &amp; C. H. Carstensen (Eds.):
<em>Multivariate and mixture distribution Rasch models: Extensions and applications</em>
(pp. 55-76). New York: Springer.
<a href="https://doi.org/10.1007/978-0-387-49839-3_4" class="external-link">doi:10.1007/978-0-387-49839-3_4</a></p>
<p>Rubin, D. B. (1981). The Bayesian bootstrap. <em>The Annals of Statistics, 9</em>(1),
130-134.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See <code><a href="tam.latreg.html">tam.latreg</a></code> for further examples of
fitting latent regression models and drawing plausible values
from models which provides an individual likelihood as an input.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 1: Dichotomous unidimensional data sim.rasch</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.sim.rasch</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">data.sim.rasch</span><span class="op">[</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">15</span> <span class="op">]</span>  <span class="co"># select subsample of students and items</span></span>
<span></span>
<span><span class="co"># estimate Rasch model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw 5 plausible values without a normality</span></span>
<span><span class="co"># assumption of the posterior and 2000 ability nodes</span></span>
<span><span class="va">pv1a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod</span>, nplausible<span class="op">=</span><span class="fl">5</span>, ntheta<span class="op">=</span><span class="fl">2000</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># draw 5 plausible values with a normality</span></span>
<span><span class="co"># assumption of the posterior and 500 ability nodes</span></span>
<span><span class="va">pv1b</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod</span>, nplausible<span class="op">=</span><span class="fl">5</span>, ntheta<span class="op">=</span><span class="fl">500</span>, normal.approx<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># distribution of first plausible value from imputation pv1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">pv1a</span><span class="op">$</span><span class="va">pv</span><span class="op">$</span><span class="va">PV1.Dim1</span> <span class="op">)</span></span>
<span><span class="co"># boxplot of all plausible values from imputation pv2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">pv1b</span><span class="op">$</span><span class="va">pv</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span> <span class="op">]</span> <span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># draw plausible values with tam.pv.mcmc function</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow<span class="op">=</span><span class="fl">500</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pv2</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> tamobj<span class="op">=</span><span class="va">mod</span>, Y<span class="op">=</span><span class="va">Y</span>, nplausible<span class="op">=</span><span class="fl">5</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pv2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summary output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pv2</span><span class="op">)</span></span>
<span><span class="co"># assessing convergence with traceplots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pv2</span>, ask<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use starting values for theta and MH factors which fulfill acceptance rates</span></span>
<span><span class="co"># from previously fitted model</span></span>
<span><span class="va">pv3</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> tamobj<span class="op">=</span><span class="va">mod</span>, Y<span class="op">=</span><span class="va">Y</span>, nplausible<span class="op">=</span><span class="fl">5</span>, theta_init<span class="op">=</span><span class="va">pv2</span><span class="op">$</span><span class="va">theta_last</span>,</span>
<span>            adj_MH<span class="op">=</span><span class="va">pv2</span><span class="op">$</span><span class="va">theta_acceptance_MH</span><span class="op">$</span><span class="va">adj_MH</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 2: Unidimensional plausible value imputation with</span></span>
<span><span class="co">#            background variables; dataset data.pisaRead from sirt package</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.pisaRead</span>, package<span class="op">=</span><span class="st">"sirt"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data.pisaRead</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="co">##   &gt; colnames(dat)</span></span>
<span>  <span class="co">##    [1] "idstud"   "idschool" "female"   "hisei"    "migra"    "R432Q01"</span></span>
<span>  <span class="co">##    [7] "R432Q05"  "R432Q06"  "R456Q01"  "R456Q02"  "R456Q06"  "R460Q01"</span></span>
<span>  <span class="co">##   [13] "R460Q05"  "R460Q06"  "R466Q02"  "R466Q03"  "R466Q06"</span></span>
<span></span>
<span><span class="co">## Note that reading items have variable names starting with R4</span></span>
<span></span>
<span><span class="co"># estimate 2PL model without covariates</span></span>
<span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"R4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">)</span>    <span class="co"># select test items from data</span></span>
<span><span class="va">mod2a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml.2pl</a></span><span class="op">(</span> resp<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2a</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fix item parameters for plausible value imputation</span></span>
<span>   <span class="co"># fix item intercepts by defining xsi.fixed</span></span>
<span><span class="va">xsi0</span> <span class="op">&lt;-</span> <span class="va">mod2a</span><span class="op">$</span><span class="va">xsi</span><span class="op">$</span><span class="va">xsi</span></span>
<span><span class="va">xsi.fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xsi0</span><span class="op">)</span><span class="op">)</span>, <span class="va">xsi0</span> <span class="op">)</span></span>
<span>   <span class="co"># fix item slopes using mod2$B</span></span>
<span><span class="co"># matrix of latent regressors female, hisei and migra</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"hisei"</span>, <span class="st">"migra"</span><span class="op">)</span> <span class="op">]</span></span>
<span><span class="va">mod2b</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> resp<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="va">items</span><span class="op">]</span>, B<span class="op">=</span><span class="va">mod2a</span><span class="op">$</span><span class="va">B</span>, xsi.fixed<span class="op">=</span><span class="va">xsi.fixed</span>, Y<span class="op">=</span><span class="va">Y</span>,</span>
<span>            pid<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">idstud</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plausible value imputation with normality assumption</span></span>
<span><span class="co"># and ignoring uncertainty about regression coefficients</span></span>
<span><span class="co">#    -&gt; the default is samp.regr=FALSE</span></span>
<span><span class="va">pv2c</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod2b</span>, nplausible<span class="op">=</span><span class="fl">10</span>, ntheta<span class="op">=</span><span class="fl">500</span>, normal.approx<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="co"># sampling of regression coefficients</span></span>
<span><span class="va">pv2d</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod2b</span>, nplausible<span class="op">=</span><span class="fl">10</span>, ntheta<span class="op">=</span><span class="fl">500</span>, samp.regr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># sampling of regression coefficients, normal approximation using the</span></span>
<span><span class="co"># theta grid from the model</span></span>
<span><span class="va">pv2e</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod2b</span>, samp.regr<span class="op">=</span><span class="cn">TRUE</span>, theta.model<span class="op">=</span><span class="cn">TRUE</span>, normal.approx<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- create list of multiply imputed datasets with plausible values</span></span>
<span><span class="co"># define dataset with covariates to be matched</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"idstud"</span>, <span class="st">"idschool"</span>, <span class="st">"female"</span>, <span class="st">"hisei"</span>, <span class="st">"migra"</span><span class="op">)</span> <span class="op">]</span></span>
<span></span>
<span><span class="co"># define plausible value names</span></span>
<span><span class="va">pvnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PVREAD"</span><span class="op">)</span></span>
<span><span class="co"># create list of imputed datasets</span></span>
<span><span class="va">datlist1</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">pv2e</span>, pvnames<span class="op">=</span><span class="va">pvnames</span>, Y<span class="op">=</span><span class="va">Y</span>, Y.pid<span class="op">=</span><span class="st">"idstud"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">datlist1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a matrix of covariates with different set of students than in pv2e</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fl">600</span>, <span class="fl">2</span> <span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># create list of multiply imputed datasets</span></span>
<span><span class="va">datlist2</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">pv2e</span>, pvnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PVREAD"</span><span class="op">)</span>, Y<span class="op">=</span><span class="va">Y1</span>, Y.pid<span class="op">=</span><span class="st">"idstud"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- fit some models in lavaan and semTools</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simsem/semTools/wiki" class="external-link">semTools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** Model 1: Linear regression</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PVREAD ~ migra + hisei</span></span>
<span><span class="st">   PVREAD ~~ PVREAD</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="va">datlist1</span>, m<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply lavaan for third imputed dataset</span></span>
<span><span class="va">mod1a</span> <span class="op">&lt;-</span> <span class="fu">lavaan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/lavaan.html" class="external-link">lavaan</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="va">datlist1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1a</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare with mod1 by looping over all datasets</span></span>
<span><span class="va">mod1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span> <span class="va">datlist1</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">dat0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mod1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/lavaan.html" class="external-link">lavaan</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="va">dat0</span> <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span> <span class="va">mod1a</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="op">)</span></span>
<span><span class="va">mod1b</span></span>
<span><span class="va">mod1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span> <span class="va">mod1b</span> <span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">mod1b</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mod1b</span><span class="op">)</span>, <span class="fl">3</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>   <span class="co"># -&gt; results coincide</span></span>
<span></span>
<span><span class="co">#*** Model 2: Path model</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PVREAD ~ migra + hisei</span></span>
<span><span class="st">   hisei ~ migra</span></span>
<span><span class="st">   PVREAD ~~ PVREAD</span></span>
<span><span class="st">   hisei ~~ hisei</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="va">datlist1</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># fit statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/lavInspect.html" class="external-link">inspect</a></span><span class="op">(</span> <span class="va">mod2</span>, what<span class="op">=</span><span class="st">"fit"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- using mitools package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mitools</span><span class="op">)</span></span>
<span><span class="co"># convert datalist into an object of class imputationList</span></span>
<span><span class="va">datlist1a</span> <span class="op">&lt;-</span> <span class="fu">mitools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mitools/man/imputationList.html" class="external-link">imputationList</a></span><span class="op">(</span> <span class="va">datlist1</span> <span class="op">)</span></span>
<span><span class="co"># fit linear regression</span></span>
<span><span class="va">mod1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">datlist1a</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">PVREAD</span> <span class="op">~</span> <span class="va">migra</span> <span class="op">+</span> <span class="va">hisei</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="fu">mitools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mitools/man/MIcombine.html" class="external-link">MIcombine</a></span><span class="op">(</span><span class="va">mod1c</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#--- using mice package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/alexanderrobitzsch/miceadds" class="external-link">miceadds</a></span><span class="op">)</span></span>
<span><span class="co"># convert datalist into a mids object</span></span>
<span><span class="va">mids1</span> <span class="op">&lt;-</span> <span class="fu">miceadds</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/miceadds/man/datalist2mids.html" class="external-link">datalist2mids</a></span><span class="op">(</span> <span class="va">datlist1</span> <span class="op">)</span></span>
<span><span class="co"># fit linear regression</span></span>
<span><span class="va">mod1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">mids1</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">PVREAD</span> <span class="op">~</span> <span class="va">migra</span> <span class="op">+</span> <span class="va">hisei</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/pool.html" class="external-link">pool</a></span><span class="op">(</span><span class="va">mod1c</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 3: Multidimensional plausible value imputation</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="co"># (1) simulate some data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">6778</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span> <span class="va">N</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">.5</span>,<span class="fl">.5</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.4</span> <span class="op">*</span> <span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.2</span> <span class="op">*</span> <span class="va">Y</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>  <span class="co"># latent regression model</span></span>
<span><span class="va">theta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.8</span> <span class="op">*</span> <span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span> <span class="va">Y</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>  <span class="co"># latent regression model</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span> <span class="va">theta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, len<span class="op">=</span><span class="va">I</span> <span class="op">)</span>, <span class="st">"-"</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">resp1</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span> <span class="va">p1</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span> <span class="va">N</span><span class="op">*</span><span class="va">I</span> <span class="op">)</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">I</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span> <span class="va">theta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, len<span class="op">=</span><span class="va">I</span> <span class="op">)</span>, <span class="st">"-"</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">resp2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span> <span class="va">p1</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span> <span class="va">N</span><span class="op">*</span><span class="va">I</span> <span class="op">)</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">I</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">resp1</span>,<span class="va">resp2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">I</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (2) define loading Matrix</span></span>
<span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span> <span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">2</span><span class="op">*</span><span class="va">I</span>, <span class="fl">2</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Q</span><span class="op">[</span><span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">I</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">I</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="va">I</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># (3) fit latent regression model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> resp<span class="op">=</span><span class="va">resp</span>, Y<span class="op">=</span><span class="va">Y</span>, Q<span class="op">=</span><span class="va">Q</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># (4) draw plausible values</span></span>
<span><span class="va">pv1</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod</span>, theta.model<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># (5) convert plausible values to list of imputed datasets</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pvnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PVFA"</span>,<span class="st">"PVFB"</span><span class="op">)</span></span>
<span><span class="co"># create list of imputed datasets</span></span>
<span><span class="va">datlist1</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">pv1</span>, pvnames<span class="op">=</span><span class="va">pvnames</span>, Y<span class="op">=</span><span class="va">Y1</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">datlist1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (6) apply statistical models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simsem/semTools/wiki" class="external-link">semTools</a></span><span class="op">)</span></span>
<span><span class="co"># define linear regression</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PVFA ~ Y1 + Y2</span></span>
<span><span class="st">   PVFA ~~ PVFA</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="va">datlist1</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (7) draw plausible values with tam.pv.mcmc function</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="va">Y</span> <span class="op">)</span></span>
<span><span class="va">pv2</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> tamobj<span class="op">=</span><span class="va">mod</span>, Y<span class="op">=</span><span class="va">Y1</span>, n.iter<span class="op">=</span><span class="fl">1000</span>, n.burnin<span class="op">=</span><span class="fl">200</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># (8) group-specific plausible values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">908</span><span class="op">)</span></span>
<span><span class="co"># create artificial grouping variable</span></span>
<span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">N</span>, replace<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">pv3</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> <span class="va">tamobj</span>, Y<span class="op">=</span><span class="va">Y1</span>, n.iter<span class="op">=</span><span class="fl">1000</span>, n.burnin<span class="op">=</span><span class="fl">200</span>, group<span class="op">=</span><span class="va">group</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># (9) plausible values with no fitted object in TAM</span></span>
<span></span>
<span><span class="co"># fit IRT model without covariates</span></span>
<span><span class="va">mod4a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> resp<span class="op">=</span><span class="va">resp</span>, Q<span class="op">=</span><span class="va">Q</span> <span class="op">)</span></span>
<span><span class="co"># define input for tam.pv.mcmc</span></span>
<span><span class="va">tamobj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> AXsi<span class="op">=</span><span class="va">mod4a</span><span class="op">$</span><span class="va">AXsi</span>, B<span class="op">=</span><span class="va">mod4a</span><span class="op">$</span><span class="va">B</span>, resp<span class="op">=</span><span class="va">mod4a</span><span class="op">$</span><span class="va">resp</span> <span class="op">)</span></span>
<span><span class="va">pmod4</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv.mcmc</span><span class="op">(</span> <span class="va">tamobj1</span>, Y<span class="op">=</span><span class="va">Y1</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#############################################################################</span></span>
<span><span class="co"># EXAMPLE 4: Plausible value imputation with measurement errors in covariates</span></span>
<span><span class="co">#############################################################################</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/alexanderrobitzsch/sirt" class="external-link">sirt</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7756</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2000</span>    <span class="co"># number of persons</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fl">10</span>     <span class="co"># number of items</span></span>
<span></span>
<span><span class="co"># simulate covariates</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">mvrnorm</span><span class="op">(</span> <span class="va">N</span>, mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, Sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">.5</span>,<span class="fl">.5</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># second covariate with measurement error with variance var.err</span></span>
<span><span class="va">var.err</span> <span class="op">&lt;-</span> <span class="fl">.3</span></span>
<span><span class="va">X.err</span> <span class="op">&lt;-</span> <span class="va">X</span></span>
<span><span class="va">X.err</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span><span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var.err</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># simulate theta</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">.5</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.4</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span> <span class="va">N</span>, sd<span class="op">=</span><span class="fl">.5</span> <span class="op">)</span></span>
<span><span class="co"># simulate item responses</span></span>
<span><span class="va">itemdiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length<span class="op">=</span><span class="va">I</span><span class="op">)</span>  <span class="co"># item difficulties</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sirt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sirt/man/sim.raschtype.html" class="external-link">sim.raschtype</a></span><span class="op">(</span> <span class="va">theta</span>, b<span class="op">=</span><span class="va">itemdiff</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#***********************</span></span>
<span><span class="co">#*** Model 0: Regression model with true variables</span></span>
<span><span class="va">mod0</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">theta</span> <span class="op">~</span> <span class="va">X</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod0</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***********************</span></span>
<span><span class="co">#*** Model 1: latent regression model with true covariates X</span></span>
<span><span class="va">xsi.fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="va">I</span>, <span class="va">itemdiff</span> <span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> <span class="va">dat</span>, xsi.fixed<span class="op">=</span><span class="va">xsi.fixed</span>, Y<span class="op">=</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw plausible values</span></span>
<span><span class="va">res1a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod1</span>, normal.approx<span class="op">=</span><span class="cn">TRUE</span>, ntheta<span class="op">=</span><span class="fl">200</span>, samp.regr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># create list of multiply imputed datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/alexanderrobitzsch/miceadds" class="external-link">miceadds</a></span><span class="op">)</span></span>
<span><span class="va">datlist1a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">res1a</span>, Y<span class="op">=</span><span class="va">X</span> <span class="op">)</span></span>
<span><span class="va">imp1a</span> <span class="op">&lt;-</span> <span class="fu">miceadds</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/miceadds/man/datalist2mids.html" class="external-link">datalist2mids</a></span><span class="op">(</span> <span class="va">datlist1a</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># fit linear model</span></span>
<span><span class="co"># linear regression with measurement errors in X</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PV.Dim1 ~ X1 + X2true</span></span>
<span><span class="st">   X2true=~ 1*X2</span></span>
<span><span class="st">   X2 ~~ 0.3*X2  #=var.err</span></span>
<span><span class="st">   PV.Dim1 ~~ PV.Dim1</span></span>
<span><span class="st">   X2true ~~ X2true</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod1a</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, <span class="va">datlist1a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1a</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***********************</span></span>
<span><span class="co">#*** Model 2: latent regression model with error-prone covariates X.err</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> <span class="va">dat</span>, xsi.fixed<span class="op">=</span><span class="va">xsi.fixed</span>, Y<span class="op">=</span><span class="va">X.err</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#***********************</span></span>
<span><span class="co">#*** Model 3: Adjustment of covariates</span></span>
<span></span>
<span><span class="va">cov.X.err</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span> <span class="va">X.err</span> <span class="op">)</span></span>
<span><span class="co"># matrix of variance of measurement errors</span></span>
<span><span class="va">measerr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">var.err</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># true covariance matrix</span></span>
<span><span class="va">cov.X</span> <span class="op">&lt;-</span> <span class="va">cov.X.err</span> <span class="op">-</span> <span class="va">measerr</span></span>
<span><span class="co"># mean of X.err</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">X.err</span><span class="op">)</span></span>
<span><span class="va">muM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">mu</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X.err</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X.err</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># reliability matrix</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span> <span class="va">cov.X.err</span> <span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">cov.X</span></span>
<span><span class="va">ident</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># adjusted scores of X</span></span>
<span><span class="va">X.adj</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="va">X.err</span> <span class="op">-</span> <span class="va">muM</span> <span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">W</span>   <span class="op">+</span> <span class="va">muM</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span> <span class="va">ident</span> <span class="op">-</span> <span class="va">W</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># fit latent regression model</span></span>
<span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> <span class="va">dat</span>, xsi.fixed<span class="op">=</span><span class="va">xsi.fixed</span>, Y<span class="op">=</span><span class="va">X.adj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw plausible values</span></span>
<span><span class="va">res3a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu">tam.pv</span><span class="op">(</span> <span class="va">mod3</span>, normal.approx<span class="op">=</span><span class="cn">TRUE</span>, ntheta<span class="op">=</span><span class="fl">200</span>, samp.regr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create list of multiply imputed datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simsem/semTools/wiki" class="external-link">semTools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#*** PV dataset 1</span></span>
<span><span class="co"># datalist with error-prone covariates</span></span>
<span><span class="va">datlist3a</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">res3a</span>, Y<span class="op">=</span><span class="va">X.err</span> <span class="op">)</span></span>
<span><span class="co"># datalist with adjusted covariates</span></span>
<span><span class="va">datlist3b</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tampv2datalist.html">tampv2datalist</a></span><span class="op">(</span> <span class="va">res3a</span>, Y<span class="op">=</span><span class="va">X.adj</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># linear regression with measurement errors in X</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PV.Dim1 ~ X1 + X2true</span></span>
<span><span class="st">   X2true=~ 1*X2</span></span>
<span><span class="st">   X2 ~~ 0.3*X2  #=var.err</span></span>
<span><span class="st">   PV.Dim1 ~~ PV.Dim1</span></span>
<span><span class="st">   X2true ~~ X2true</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod3a</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, <span class="va">datlist3a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3a</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">   PV.Dim1 ~ X1 + X2</span></span>
<span><span class="st">   PV.Dim1 ~~ PV.Dim1</span></span>
<span><span class="st">        "</span></span>
<span><span class="va">mod3b</span> <span class="op">&lt;-</span> <span class="fu">semTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/semTools/man/semTools-deprecated.html" class="external-link">lavaan.mi</a></span><span class="op">(</span> <span class="va">lavmodel</span>, <span class="va">datlist3b</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod3b</span>, standardized<span class="op">=</span><span class="cn">TRUE</span>, rsquare<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#=&gt; mod3b leads to the correct estimate.</span></span>
<span></span>
<span><span class="co">#*********************************************</span></span>
<span><span class="co"># plausible value imputation for abilities and error-prone</span></span>
<span><span class="co"># covariates using the mice package</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/alexanderrobitzsch/miceadds" class="external-link">miceadds</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating the likelihood for plausible value for abilities</span></span>
<span><span class="va">mod11</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="tam.mml.html">tam.mml</a></span><span class="op">(</span> <span class="va">dat</span>, xsi.fixed<span class="op">=</span><span class="va">xsi.fixed</span> <span class="op">)</span></span>
<span><span class="va">likePV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CDM/man/IRT.likelihood.html" class="external-link">IRT.likelihood</a></span><span class="op">(</span><span class="va">mod11</span><span class="op">)</span></span>
<span><span class="co"># creating the likelihood for error-prone covariate X2</span></span>
<span><span class="va">lavmodel</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  X2true=~ 1*X2</span></span>
<span><span class="st">  X2 ~~ 0.3*X2</span></span>
<span><span class="st">    "</span></span>
<span><span class="va">mod12</span> <span class="op">&lt;-</span> <span class="fu">lavaan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span> <span class="va">lavmodel</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X.err</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod12</span><span class="op">)</span></span>
<span><span class="va">likeX2</span> <span class="op">&lt;-</span> <span class="fu">TAM</span><span class="fu">::</span><span class="fu"><a href="IRTLikelihood.cfa.html">IRTLikelihood.cfa</a></span><span class="op">(</span> data<span class="op">=</span><span class="va">X.err</span>, cfaobj<span class="op">=</span><span class="va">mod12</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">likeX2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-- create data input for mice package</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> <span class="st">"PVA"</span><span class="op">=</span><span class="cn">NA</span>, <span class="st">"X1"</span><span class="op">=</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="st">"X2"</span><span class="op">=</span><span class="cn">NA</span>  <span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span></span>
<span><span class="va">predictorMatrix</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">predictorMatrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">predictorMatrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span>
<span><span class="va">imputationMethod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="va">V</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imputationMethod</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span>
<span><span class="va">imputationMethod</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PVA"</span>,<span class="st">"X2"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"plausible.values"</span></span>
<span></span>
<span><span class="co">#-- create argument lists for plausible value imputation</span></span>
<span><span class="co"># likelihood and theta grid of plausible value derived from IRT model</span></span>
<span><span class="va">like</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"PVA"</span><span class="op">=</span><span class="va">likePV</span>, <span class="st">"X2"</span><span class="op">=</span><span class="va">likeX2</span> <span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="st">"PVA"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">likePV</span>,<span class="st">"theta"</span><span class="op">)</span>, <span class="st">"X2"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">likeX2</span>, <span class="st">"theta"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#-- initial imputations</span></span>
<span><span class="va">data.init</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span><span class="va">data.init</span><span class="op">$</span><span class="va">PVA</span> <span class="op">&lt;-</span> <span class="va">mod11</span><span class="op">$</span><span class="va">person</span><span class="op">$</span><span class="va">EAP</span></span>
<span><span class="va">data.init</span><span class="op">$</span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="va">X.err</span><span class="op">[</span>,<span class="st">"X2"</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#-- imputation using the mice and miceadds package</span></span>
<span><span class="va">imp1</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, predictorMatrix<span class="op">=</span><span class="va">predictorMatrix</span>, m<span class="op">=</span><span class="fl">4</span>, maxit<span class="op">=</span><span class="fl">6</span>,</span>
<span>             method<span class="op">=</span><span class="va">imputationMethod</span>,  allow.na<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>             theta<span class="op">=</span><span class="va">theta</span>, like<span class="op">=</span><span class="va">like</span>, data.init<span class="op">=</span><span class="va">data.init</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">imp1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute linear regression</span></span>
<span><span class="va">mod4a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="va">imp1</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span> <span class="va">PVA</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/pool.html" class="external-link">pool</a></span><span class="op">(</span><span class="va">mod4a</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alexander Robitzsch.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

