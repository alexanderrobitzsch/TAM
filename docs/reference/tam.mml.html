<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Test Analysis Modules: Marginal Maximum Likelihood Estimation — tam.mml • TAM</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Test Analysis Modules: Marginal Maximum Likelihood Estimation — tam.mml" />
<meta property="og:description" content="Modules for psychometric test analysis demonstrated
  with the help of artificial example data.
  The package includes MML and JML estimation of
  uni- and multidimensional IRT (Rasch,  2PL, Generalized Partial
  Credit, Rating Scale, Multi Facets, Nominal Item Response)
  models, fit statistic computation, standard error estimation, as
  well as plausible value imputation and weighted likelihood
  estimation of ability." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Versions">3.7-vv</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/alexanderrobitzsch/TAM/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test Analysis Modules: Marginal Maximum Likelihood Estimation</h1>
    
    <div class="hidden name"><code>tam.mml.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Modules for psychometric test analysis demonstrated
  with the help of artificial example data.
  The package includes MML and JML estimation of
  uni- and multidimensional IRT (Rasch,  2PL, Generalized Partial
  Credit, Rating Scale, Multi Facets, Nominal Item Response)
  models, fit statistic computation, standard error estimation, as
  well as plausible value imputation and weighted likelihood
  estimation of ability.</p>
    </div>

    <pre class="usage"><span class='fu'>tam</span>(<span class='no'>resp</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"1PL"</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>tam.mml</span>(<span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>group</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"1PL"</span>, <span class='kw'>formulaY</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>dataY</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>ndim</span><span class='kw'>=</span><span class='fl'>1</span>,  <span class='kw'>pid</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>beta.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>variance.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>est.variance</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"cases"</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>B</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>,  <span class='kw'>Q</span><span class='kw'>=</span><span class='kw'>NULL</span>,  <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>pweights</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>item.elim</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>() )

<span class='fu'>tam.mml.2pl</span>(<span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>group</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>, <span class='kw'>formulaY</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>dataY</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>ndim</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>beta.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>variance.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>est.variance</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>gamma.init</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>pweights</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>item.elim</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>() )

<span class='fu'>tam.mml.mfr</span>(<span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>group</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"1PL"</span>, <span class='kw'>formulaY</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>dataY</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>ndim</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>xsi.setnull</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>xsi.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>beta.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>variance.inits</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>est.variance</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>formulaA</span><span class='kw'>=</span>~<span class='no'>item</span>+<span class='no'>item</span>:<span class='no'>step</span>,
    <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"cases"</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='kw'>NULL</span>,  <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>facets</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>pweights</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(), <span class='kw'>delete.red.items</span><span class='kw'>=</span><span class='fl'>TRUE</span> )

<span class='co'># S3 method for tam</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>object</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for tam.mml</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>object</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for tam</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for tam.mml</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>resp</th>
      <td><p>Data frame with polytomous item responses \(k=0,...,K\).
     Missing responses must be declared as <code>NA</code>.</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>A matrix of covariates in latent regression. Note that the
     intercept is automatically included as the first predictor.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>An optional vector of group identifiers</p></td>
    </tr>
    <tr>
      <th>irtmodel</th>
      <td><p>For fixed item slopes (in <code>tam.mml</code>)
     options include <code>PCM</code> (partial credit model), <code>PCM2</code>
     (partial credit model with ConQuest parametrization
     <code>'item+item*step'</code> and <code>RSM</code> (rating scale model;
     the ConQuest parametrization <code>'item+step'</code>). <br />
     For estimated item slopes (only available in <code>tam.mml.2pl</code>)
     options are <code>2PL</code> (all slopes of item categories
     are estimated; Nominal Item Response Model),
     <code>GPCM</code> (generalized partial credit
     model in which every item gets one and only slope
     parameter per dimension) and <code>2PL.groups</code> or <code>GPCM.groups</code>
     (subsets of items get same item slope estimates)
     and a design matrix <code>E</code> on item slopes in the
     generalized partial credit model (<code>GPCM.design</code>,
     see Examples).
     Note that item slopes can not be estimated with faceted
     designs using the function <code>tam.mml.mfr</code>. However,
     it is easy to use pre-specified design matrices and apply
     some restrictions to <code>tam.mml.2pl</code> (see Example 14, Model 3).</p></td>
    </tr>
    <tr>
      <th>formulaY</th>
      <td><p>An <span style="R">R</span> formula for latent regression. Transformations of predictors
     in \(Y\) (included in <code>dataY</code>) can be easily specified,
     e. g. <code>female*race</code> or <code><a href='https://rdrr.io/r/base/AsIs.html'>I(age^2)</a></code>.</p></td>
    </tr>
    <tr>
      <th>dataY</th>
      <td><p>An optional data frame with possible covariates \(Y\) in latent regression.
     This data frame is used if an <span style="R">R</span> formula in <code>formulaY</code>
     is specified.</p></td>
    </tr>
    <tr>
      <th>ndim</th>
      <td><p>Number of dimensions (is not needed to determined by the user)</p></td>
    </tr>
    <tr>
      <th>pid</th>
      <td><p>An optional vector of person identifiers</p></td>
    </tr>
    <tr>
      <th>xsi.fixed</th>
      <td><p>A matrix with two columns for fixing \(\xi\) parameters.
     1st column: index of \(\xi\) parameter, 2nd column: fixed value</p></td>
    </tr>
    <tr>
      <th>xsi.setnull</th>
      <td><p>A vector of strings indicating which \(\xi\)
    elements should be set to zero which do have entries in
    <code>xsi.setnull</code> in their labels (see Example 10a).</p></td>
    </tr>
    <tr>
      <th>xsi.inits</th>
      <td><p>A matrix with two columns (in the same way defined as in
     <code>xsi.fixed</code> with initial value for \(\xi\).</p></td>
    </tr>
    <tr>
      <th>beta.fixed</th>
      <td><p>A matrix with three columns for fixing regression coefficients.
     1st column: Index of \(Y\) value, 2nd column: dimension,
     3rd column: fixed \(\beta\) value. <br />
     If no constraints should be imposed on \(\beta\), then
     set <code>beta.fixed=FALSE</code> (see Example 2, Model <code>2_4</code>).</p></td>
    </tr>
    <tr>
      <th>beta.inits</th>
      <td><p>A matrix (same format as in <code>beta.fixed</code>)
     with initial \(\beta\) values</p></td>
    </tr>
    <tr>
      <th>variance.fixed</th>
      <td><p>An optional matrix with three columns for fixing
     entries in covariance matrix:
     1st column: dimension 1, 2nd column: dimension 2,
     3rd column: fixed value</p></td>
    </tr>
    <tr>
      <th>variance.inits</th>
      <td><p>Initial covariance matrix in estimation. All matrix entries have to be
     specified and this matrix is NOT in the same format like
     <code>variance.fixed</code>.</p></td>
    </tr>
    <tr>
      <th>est.variance</th>
      <td><p>Should the covariance matrix be estimated? This argument
     applies to estimated item slopes in <code>tam.mml.2pl</code>.
     The default is <code>FALSE</code> which means that latent
     variables (in the first group) are standardized in 2PL estimation.</p></td>
    </tr>
    <tr>
      <th>constraint</th>
      <td><p>Set sum constraint for parameter identification
    for <code>items</code> or <code>cases</code> (applies to
    <code>tam.mml</code> and <code>tam.mml.mfr</code>)</p></td>
    </tr>
    <tr>
      <th>A</th>
      <td><p>An optional array of dimension \( I \times (K+1) \times N_\xi\).
     Only \(\xi\) parameters are estimated, entries in \(A\)
     only correspond to the design.</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>An optional array of dimension \( I \times (K+1) \times D\).
     In case of <code>tam.mml.2pl</code> entries of the \(B\) matrix can be
     estimated.</p></td>
    </tr>
    <tr>
      <th>B.fixed</th>
      <td><p>An optional matrix with four columns for fixing \(B\) matrix entries in 2PL estimation.
  1st column: item index, 2nd column: category, 3rd column: dimension,
  4th column: fixed value.</p></td>
    </tr>
    <tr>
      <th>Q</th>
      <td><p>An optional \(I \times D\) matrix (the Q-matrix) which specifies the
  loading structure of items on dimensions.</p></td>
    </tr>
    <tr>
      <th>est.slopegroups</th>
      <td><p>A vector of integers of length \(I\) for estimating item slope
  parameters of item groups. This function only applies to
  the generalized partial credit model <br /> (<code>irtmodel="2PL.groups"</code>).</p></td>
    </tr>
    <tr>
      <th>E</th>
      <td><p>An optional design matrix for estimating item slopes
  in the generalized partial credit model (<code>irtmodel="GPCM.design"</code>)</p></td>
    </tr>
    <tr>
      <th>gamma.init</th>
      <td><p>Optional initial \(gamma\) parameter vector
(<code>irtmodel="GPCM.design"</code>).</p></td>
    </tr>
    <tr>
      <th>pweights</th>
      <td><p>An optional vector of person weights</p></td>
    </tr>
    <tr>
      <th>formulaA</th>
      <td><p>Design formula (only applies to <code>tam.mml.mfr</code>).
    See Example 8. It is also to possible to set all effects
  of a facet to zero, e.g. <code>item*step + 0*rater</code> (see Example 10a).</p></td>
    </tr>
    <tr>
      <th>facets</th>
      <td><p>A data frame with facet entries (only applies to
    <code>tam.mml.mfr</code>)</p></td>
    </tr>
    <tr>
      <th>userfct.variance</th>
      <td><p>Optional user customized function for variance specification
(See Simulated Example 17).</p></td>
    </tr>
    <tr>
      <th>variance.Npars</th>
      <td><p>Number of estimated parameters of variance matrix
if a <code>userfct.variance</code> is provided.</p></td>
    </tr>
    <tr>
      <th>item.elim</th>
      <td><p>Optional logical indicating whether an item with has
    only zero entries should be removed from the analysis. The default
    is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical indicating whether output should
be printed during iterations. This argument replaces <code>control$progress</code>.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A list of control arguments for the algorithm: <br /><br />
  <code> list( nodes=seq(-6,6,len=21), snodes=0, QMC=TRUE,</code><br />
    <code>        convD=.001,conv=.0001, convM=.0001, Msteps=4,   </code><br />
    <code>        maxiter=1000, max.increment=1, </code><br />
    <code>        min.variance=.001, progress=TRUE, ridge=0,    </code><br />
    <code>        seed=NULL, xsi.start0=0, increment.factor=1,  </code><br />
    <code>        fac.oldxsi=0, acceleration="none", dev_crit="absolute" )  </code><br />
    <code>        trim_increment="half" )  </code><br /></p>
<p><code>nodes</code>: the discretized \(\theta\) nodes for numerical integration</p>
<p><code>snodes</code>: number of simulated \(\theta\) nodes for stochastic integration.
    If <code>snodes=0</code>, numerical integration is used.</p>
<p><code>QMC</code>: A logical indicating whether quasi Monte Carlo integration
   (Gonzales at al., 2006; Pan &amp; Thompson, 2007) should be used. The default is <code>TRUE</code>.
Quasi Monte Carlo integration is a nonstochastic integration approach
but prevents the very demanding numeric integration using Gaussian quadrature.
In case of <code>QMC=FALSE</code>, "ordinary" stochastic integration is used
(see the section <em>Integration</em> in Details).</p>

<p><code>convD</code>: Convergence criterion for deviance</p>
<p><code>conv</code>: Convergence criterion for item parameters and regression
coefficients</p>
<p><code>convM</code>: Convergence criterion for item parameters within each
M step</p>
<p><code>Msteps</code>: Number of M steps for item parameter estimation.
A high value of M steps could be helpful in cases of non-convergence.
In <code>tam.mml</code>, <code>tam.mml.2pl</code> and <code>tam.mml.mfr</code>, the default is
set to 4, in <code>tam.mml.3pl</code> it is set to 10.</p>
<p><code>maxiter</code>: Maximum number of iterations</p>
<p><code>max.increment</code>: Maximum increment for item parameter change for
every iteration</p>
<p><code>min.variance</code>: Minimum variance to be estimated during iterations.</p>
<p><code>progress</code>: A logical indicating whether computation progress should
be displayed at <span style="R">R</span> console</p>
<p><code>ridge</code>: A numeric value or a vector of ridge parameter(s)
for the latent regression which is added to the covariance matrix
\(Y'Y\) of predictors in the diagonal.</p>
<p><code>seed</code>: An optional integer defining the simulation seed
(important for reproducible results for stochastic integration)</p>
<p><code>xsi.start0</code>: A numeric value. The value of 0 indicates that for all
parameters starting values are provided. A value of 1 means that all
starting values are set to zero and a value of 2 means that only
starting values of item parameters (but not facet parameters)
are used.</p>
<p><code>increment.factor</code>: A value (larger than one)
    which defines the extent of the decrease of the maximum
    increment of item parameters in every iteration. The maximum increment
    in iteration <code>iter</code> is defined as
    <code>max.increment*increment.factor^(-iter)</code>
    where <code>max.increment=1</code>. Using a value larger than 1 helps
        to reach convergence in some non-converging analyses (see Example 12).</p>
<p><code>fac.oldxsi</code>: An optional numeric value \(f\) between 0 and 1 which
defines the weight of parameter values in previous iteration. If \(\xi_t\)
denotes a parameter update in iteration \(t\), \(\xi_{t-1}\) is the
parameter value of iteration \(t-1\), then the modified parameter value
is defined as \( \xi_t^*=(1-f) \cdot \xi_t + f \cdot \xi_{t-1}\).
Especially in cases where the deviance increases, setting the parameter
larger than 0 (maybe .4 or .5) is helpful in stabilizing the algorithm
(see Example 15).</p>
<p><code>acceleration</code>: String indicating whether convergence acceleration of
the EM algorithm should be employed. Options are <code>"none"</code> (no acceleration,
the default), the monotone overrelaxation method of <code>"Yu"</code> (Yu, 2012) and
<code>"Ramsay"</code> for the Ramsay (1975) acceleration method.</p>
<p><code>dev_crit</code>: Criterion for convergence in deviance. <code>dev_crit="absolute"</code>
refers to absolute differences in successive deviance values, while
<code>dev_crit="relative"</code> refers to relative differences.</p>
<p><code>trim_increment</code>: Type of method for trimming parameter increments in
algorithm. Possible types are <code>"half"</code> or "<code>"cut"</code>.
<br /></p>

</td>
    </tr>
    <tr>
      <th>delete.red.items</th>
      <td><p>An optional logical indicating whether redundant
    generalized items (with no observations) should be eliminated.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>Object of class <code>tam</code> or <code>tam.mml</code> (only for <code>summary.tam</code>
functions)</p></td>
    </tr>
    <tr>
      <th>file</th>
      <td><p>A file name in which the summary output should be written
(only for <code>summary.tam</code> functions)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments to be passed</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Object of class <code>tam</code> or <code>tam.mml</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The multidimensional item response model in <span class="pkg">TAM</span> is
described in Adams, Wilson and Wu (1997) or Adams and Wu (2007).</p>
<p>The data frame <code>resp</code> contains item responses of \(N\) persons (in rows)
at \(I\) items (in columns), each item having at most
\(K\) categories \(k=0,...,K\).
The item response model has \(D\) dimensions of the \(\theta\) ability
vector and can be written as
$$
        P( X_{pi}=k | \theta_p )  \propto exp( b_{ik} \theta_p + a_{ik} \xi )
        $$
The symbol \(\propto \) means that response probabilities are normalized such
that \( \sum _k P( X_{pi}=k | \theta_p )=1 \).</p>
<p>Item category thresholds for item \(i\) in category \(k\)
are written as a linear combination
\(a_i \xi\) where the vector \(\xi\) of length \(N_\xi\)
contains generalized item parameters and
\(A=( a_{ik} )_{ik}=( a_i )_{i} \) is
a three-dimensional design array (specified in <code>A</code>).</p>
<p>The scoring vector \(b_{ik}\) contains the fixed (in <code>tam.mml</code>)
or estimated (in <code>tam.mml.2pl</code>) scores of item \(i\) in category \(k\)
on dimension \(d\).</p>
<p>For <code>tam.mml.2pl</code> and <code>irtmodel="GPCM.design"</code>, item slopes \(a_i\)
can be written as a linear combination \(a_i=( E \gamma)_i \)
of basis item slopes which is an analogue
of the LLTM for item slopes (see Example 7; Embretson, 1999).</p>
<p>The latent regression model regresses the latent trait \(\theta_p\)
on covariates \(Y\) which results in
$$
    \theta_p=Y \beta + \epsilon_p, \epsilon_p \sim N_D ( 0, \Sigma )
$$</p>
<p>Where \(\beta\) is a \(N_Y\) times \(D\) matrix of regression
coefficients for \(N_Y\) covariates in \(Y\).</p>
<p>The multiple group model for groups
\(g=1,...,G\) is implemented for unidimensional and multidimensional item
response models. In this case, variance heterogeneity is allowed
$$
    \theta_p=Y \beta + \epsilon_p, \epsilon_p \sim N ( 0, \sigma_g^2 )
$$</p>
<p><b>Integration</b>: Uni- and multidimensional integrals are approximated by
posing a uni- or multivariate normality assumption. The default is Gaussian
quadrature with nodes defined in <code>control$nodes</code>. For \(D\)-dimensional
IRT models, the \(D\)-dimensional cube consisting of the vector
<code>control$nodes</code> in all dimensions is used. If the user specifies
<code>control$snodes</code> with a value larger than zero, then Quasi-Monte Carlo
integration (Pan &amp; Thomas, 2007; Gonzales et al., 2006) with <code>control$snodes</code> is used
(because <code>control$QMC=TRUE</code> is set by default). If
<code>control$QMC=FALSE</code> is specified, then stochastic (Monte Carlo) integration
is employed with <code>control$snodes</code> stochastic nodes.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with following entries:</p>
<dt>xsi</dt><dd><p>Vector of \(\xi\) parameter estimates and their
corresponding standard errors</p></dd>
<dt>xsi.facets</dt><dd><p>Data frame of \(\xi\) parameters and corresponding
constraints for multifacet models</p></dd>
<dt>beta</dt><dd><p>Matrix of \(\beta\) regression coefficient estimates</p></dd>
<dt>variance</dt><dd><p>Covariance matrix. In case of multiple groups,
    it is a vector indicating heteroscedastic variances</p></dd>
<dt>item</dt><dd><p>Data frame with item parameters. The column <code>xsi.item</code>
denotes the item difficulty of polytomous items in the parametrization
<code>irtmodel="PCM2"</code>.</p></dd>
<dt>item_irt</dt><dd><p>IRT parameterization of item parameters</p></dd>
<dt>person</dt><dd><p>Matrix with person parameter estimates.
    <code>EAP</code> is the mean of the posterior distribution and <code>SD.EAP</code>
    the corresponding standard deviation</p></dd>
<dt>pid</dt><dd><p>Vector of person identifiers</p></dd>
<dt>EAP.rel</dt><dd><p>EAP reliability</p></dd>
<dt>post</dt><dd><p>Posterior distribution for item response pattern</p></dd>
<dt>rprobs</dt><dd><p>A three-dimensional array with estimated response probabilities
        (dimensions are items \(\times\) categories \(\times\)
      theta length)</p></dd>
<dt>itemweight</dt><dd><p>Matrix of item weights</p></dd>
<dt>theta</dt><dd><p>Theta grid</p></dd>
<dt>n.ik</dt><dd><p>Array of expected counts: theta class \(\times\)
item \(\times\) category \(\times\) group</p></dd>
<dt>pi.k</dt><dd><p>Marginal trait distribution at grid <code>theta</code></p></dd>
<dt>Y</dt><dd><p>Matrix of covariates</p></dd>
<dt>resp</dt><dd><p>Original data frame</p></dd>
<dt>resp.ind</dt><dd><p>Response indicator matrix</p></dd>
<dt>group</dt><dd><p>Group identifier</p></dd>
<dt>G</dt><dd><p>Number of groups</p></dd>
<dt>formulaY</dt><dd><p>Formula for latent regression</p></dd>
<dt>dataY</dt><dd><p>Data frame for latent regression</p></dd>
<dt>pweights</dt><dd><p>Person weights</p></dd>
<dt>time</dt><dd><p>Computation time</p></dd>
<dt>A</dt><dd><p>Design matrix \(A\) for \(\xi\) parameters</p></dd>
<dt>B</dt><dd><p>Fixed or estimated loading matrix</p></dd>
<dt>se.B</dt><dd><p>Standard errors of \(B\) parameters</p></dd>
<dt>nitems</dt><dd><p>Number of items</p></dd>
<dt>maxK</dt><dd><p>Maximum number of categories</p></dd>
<dt>AXsi</dt><dd><p>Estimated item intercepts \( a_{ik} \xi\)</p></dd>
<dt>AXsi_</dt><dd><p>Estimated item intercepts -\( a_{ik} \xi\).
Note that in <code>summary.tam</code>, the parameters <code>AXsi_</code>
are displayed.</p></dd>
<dt>se.AXsi</dt><dd><p>Standard errors of \(a_{ik} \xi\) parameters</p></dd>
<dt>nstud</dt><dd><p>Number of persons</p></dd>
<dt>resp.ind.list</dt><dd><p>List of response indicator vectors</p></dd>
<dt>hwt</dt><dd><p>Individual posterior distribution</p></dd>
<dt>like</dt><dd><p>Individual likelihood</p></dd>
<dt>ndim</dt><dd><p>Number of dimensions</p></dd>
<dt>xsi.fixed</dt><dd><p>Fixed \(\xi\) parameters</p></dd>
<dt>xsi.fixed.estimated</dt><dd><p>Matrix of estimated \(\xi\) parameters
    in form of <code>xsi.fixed</code> which can
    be used for parameter fixing in subsequent estimations.</p></dd>
<dt>B.fixed</dt><dd><p>Fixed loading parameters (only applies to <code>tam.mml.2pl</code>)</p></dd>
<dt>B.fixed.estimated</dt><dd><p>Matrix of estimated \(B\) parameters
   in the same format as <code>B.fixed</code>.</p></dd>
<dt>est.slopegroups</dt><dd><p>An index vector of item groups of common slope
parameters (only applies to <code>tam.mml.2pl</code>)</p></dd>
<dt>E</dt><dd><p>Design matrix for estimated item slopes in the generalized partial
credit model (only applies to <code>tam.mml.2pl</code> in case of
<code>irtmodel="GPCM.design"</code>)</p></dd>
<dt>basispar</dt><dd><p>Vector of \(\gamma\) parameters of the linear combination
\(a_i=( E \gamma)_i \) for item slopes (only applies to
<code>tam.mml.2pl</code> in case of <code>irtmodel='GPCM.design'</code>)</p></dd>
<dt>formulaA</dt><dd><p>Design formula (only applies to <code>tam.mml.mfr</code>)</p></dd>
<dt>facets</dt><dd><p>Data frame with facet entries (only applies to
  <code>tam.mml.mfr</code>)</p></dd>
<dt>variance.fixed</dt><dd><p>Fixed covariance matrix</p></dd>
<dt>nnodes</dt><dd><p>Number of theta nodes</p></dd>
<dt>deviance</dt><dd><p>Final deviance</p></dd>
<dt>ic</dt><dd><p>Vector with information criteria</p></dd>
<dt>deviance.history</dt><dd><p>Deviance history in iterations</p></dd>
<dt>control</dt><dd><p>List of control arguments</p></dd>
<dt>latreg_stand</dt><dd><p>List containing standardized regression coefficients</p></dd>
<dt>...</dt><dd><p>Further values</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Adams, R. J., Wilson, M., &amp; Wu, M. (1997).
Multilevel item response models: An approach to errors in
variables regression. <em>Journal of Educational and Behavioral
Statistics, 22</em>, 47-76.
doi: <a href='https://doi.org/10.3102/10769986022001047'>10.3102/10769986022001047</a></p>
<p>Adams, R. J., &amp; Wu, M. L. (2007). The mixed-coefficients multinomial logit model.
A generalized form of the Rasch model. In M. von Davier &amp; C. H. Carstensen (Eds.),
<em>Multivariate and mixture distribution Rasch models: Extensions and applications</em>
(pp. 55-76). New York: Springer.
doi: <a href='https://doi.org/10.1007/978-0-387-49839-3_4'>10.1007/978-0-387-49839-3_4</a></p>
<p>Embretson, S. E. (1999). Generating items during testing:
Psychometric issues and models. <em>Psychometrika, 64</em>, 407-433.
doi: <a href='https://doi.org/10.1007/BF02294564'>10.1007/BF02294564</a></p>
<p>Gonzalez, J., Tuerlinckx, F., De Boeck, P., &amp; Cools, R. (2006).
Numerical integration in logistic-normal models.
<em>Computational Statistics &amp; Data Analysis, 51</em>, 1535-1548.
doi: <a href='https://doi.org/10.1016/j.csda.2006.05.003'>10.1016/j.csda.2006.05.003</a></p>
<p>Pan, J., &amp; Thompson, R. (2007). Quasi-Monte Carlo estimation in
generalized linear mixed models. <em>Computational Statistics &amp;
Data Analysis, 51</em>, 5765-5775.
doi: <a href='https://doi.org/10.1016/j.csda.2006.10.003'>10.1016/j.csda.2006.10.003</a></p>
<p>Ramsay, J. O. (1975). Solving implicit equations in psychometric data analysis.
<em>Psychometrika, 40</em>(3), 337-360.
doi: <a href='https://doi.org/10.1007/BF02291762'>10.1007/BF02291762</a></p>
<p>Yu, Y. (2012). Monotonically overrelaxed EM algorithms.
<em>Journal of Computational and Graphical Statistics, 21</em>(2), 518-537.
doi: <a href='https://doi.org/10.1080/10618600.2012.672115'>10.1080/10618600.2012.672115</a></p>
<p>Wu, M. L., Adams, R. J., Wilson, M. R. &amp; Haldane, S. (2007).
<em>ACER ConQuest Version 2.0</em>. Mulgrave.
https://shop.acer.edu.au/acer-shop/group/CON3.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>For more than three dimensions, quasi-Monte Carlo or stochastic integration
is recommended because otherwise problems in memory allocation and large
computation time will result. Choose in <code>control</code> a suitable value of
the number of quasi Monte Carlo or stochastic nodes <code>snodes</code>
(say, larger than 1000). See Pan and Thompson (2007) or Gonzales et al. (2006)
for more details.</p>
<p>In faceted models (<code>tam.mml.mfr</code>), parameters which cannot be estimated
are fixed to <code>99</code>.</p>
<p>Several choices can be made if your model does not converge. First, the number
of iterations within a M step can be increased (<code>Msteps=10</code>).
Second, the absolute value of increments can be forced with increasing
iterations (set a value higher than 1 to <code>max.increment</code>, maybe 1.05).
Third, change in estimated parameters can be stabilized by <code>fac.oldxsi</code> for
which a value of 0 (the default) and a value of 1 can be chosen. We recommend
values between .5 and .8 if your model does not converge.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See <code><a href='data.cqc.html'>data.cqc01</a></code> for more examples which is are similar to the ones
in the ConQuest manual (Wu, Adams, Wilson &amp; Haldane, 2007).</p>
<p>See <code><a href='tam.jml.html'>tam.jml</a></code> for joint maximum likelihood estimation.</p>
<p>Standard errors are estimated by a rather crude (but quick) approximation.
Use <code><a href='tam.se.html'>tam.se</a></code> for improved standard errors.</p>
<p>For model comparisons see <code><a href='anova.tam.html'>anova.tam</a></code>.</p>
<p>See <code><a href='https://rdrr.io/pkg/sirt/man/tam2mirt.html'>sirt::tam2mirt</a></code> for converting
<code>tam</code> objects into objects of class
<code><a href='https://rdrr.io/pkg/mirt/man/mirt.html'>mirt::mirt</a></code> in the <span class="pkg">mirt</span> package.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 1: dichotomous data</span>
<span class='co'># data.sim.rasch: 2000 persons, 40 items</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.sim.rasch</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1: Rasch model (MML estimation)</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>)
<span class='co'># extract item parameters</span>
<span class='no'>mod1</span>$<span class='no'>item</span>    <span class='co'># item difficulties</span>

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># WLE estimation</span>
<span class='no'>wle1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.wle.html'>tam.wle</a></span>( <span class='no'>mod1</span> )
<span class='co'># item fit</span>
<span class='no'>fit1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.fit.html'>tam.fit</a></span>(<span class='no'>mod1</span>)
<span class='co'># plausible value imputation</span>
<span class='no'>pv1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.pv.html'>tam.pv</a></span>(<span class='no'>mod1</span>, <span class='kw'>normal.approx</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>ntheta</span><span class='kw'>=</span><span class='fl'>300</span>)
<span class='co'># standard errors</span>
<span class='no'>se1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.se.html'>tam.se</a></span>( <span class='no'>mod1</span> )
<span class='co'># summary</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'>#-- specification with tamaan</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
   F=~ I1__I40;
   F ~~ F
 ITEM TYPE:
   ALL(Rasch)
   "</span>
<span class='no'>mod1t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1t</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1a: Rasch model with fixed item difficulties from 'mod1'</span>
<span class='no'>xsi0</span> <span class='kw'>&lt;-</span> <span class='no'>mod1</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>
<span class='no'>xsi.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>:(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>xsi0</span>)), <span class='no'>xsi0</span> )
        <span class='co'># define vector with fixed item difficulties</span>
<span class='no'>mod1a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='no'>xsi.fixed</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1a</span>)

<span class='co'># Usage of the output value mod1$xsi.fixed.estimated has the right format</span>
<span class='co'># as the input of xsi.fixed</span>
<span class='no'>mod1aa</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='no'>mod1</span>$<span class='no'>xsi.fixed.estimated</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1b</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1b: Rasch model with initial xsi parameters for items 2 (item difficulty b=-1.8),</span>
<span class='co'># item 4 (b=-1.6) and item 40 (b=2)</span>
<span class='no'>xsi.inits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>40</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>1.8</span>,-<span class='fl'>1.6</span>,<span class='fl'>2</span>))
<span class='no'>mod1b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>xsi.inits</span><span class='kw'>=</span><span class='no'>xsi.inits</span> )

<span class='co'>#-- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
   F=~ I1__I40
   F ~~ F
   # Fix item difficulties. Note that item intercepts instead of difficulties
   # must be specified.
   I2 | 1.8*t1
   I4 | 1.6*t1
 ITEM TYPE:
   ALL(Rasch)
   "</span>
<span class='no'>mod1bt</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1bt</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1c: 1PL estimation with sum constraint on item difficulties</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.sim.rasch</span>
<span class='co'># modify A design matrix to include the sum constraint</span>
<span class='no'>des</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>des</span>$<span class='no'>A</span>[,, - <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>) ]
<span class='no'>A1</span>[ <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>),<span class='fl'>2</span>, ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>A1</span>[,<span class='fl'>2</span>,]
<span class='co'># estimate model</span>
<span class='no'>mod1c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span>,
           <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.1</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1c</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1d: estimate constraint='items' using tam.mml.mfr</span>
<span class='no'>formulaA</span><span class='kw'>=</span>~ <span class='fl'>0</span> + <span class='no'>item</span>
<span class='no'>mod1d</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>,
                     <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.1</span>), <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1d</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1e: This sum constraint can also be obtained by using the argument</span>
<span class='co'># constraint="items" in tam.mml</span>
<span class='no'>mod1e</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1e</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 1d2: estimate constraint='items' using tam.mml.mfr</span>
<span class='co'># long format response data</span>
<span class='no'>resp.long</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>dat</span>)

<span class='co'># pid and item facet specifications are necessary</span>
<span class='co'>#     Note, that we recommend the facet labels to be sortable in the same order that the</span>
<span class='co'>#     results are desired.</span>
<span class='co'>#     compare to: facets &lt;- data.frame( "item"=rep(colnames(dat), each=nrow(dat)) )</span>
<span class='no'>pid</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>dat</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>))
<span class='no'>itemnames</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"I"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>'%0'</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/nchar.html'>nchar</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>))), <span class='st'>'i'</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>''</span> ),
                    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>)) ) )
<span class='no'>facets</span>   <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>( <span class='st'>"item_"</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='no'>itemnames</span>, <span class='kw'>each</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>dat</span>)) )
<span class='no'>formulaA</span><span class='kw'>=</span>~ <span class='fl'>0</span> + <span class='no'>item_</span>

<span class='no'>mod1d2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp.long</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.1</span>),
                       <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>pid</span>)
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>mod1d</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span><span class='kw'>==</span><span class='no'>mod1d2</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span>) )
}


<span class='co'>#************************************************************</span>
<span class='co'># Model 2: 2PL model</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>,<span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>)

<span class='co'># extract item parameters</span>
<span class='no'>mod2</span>$<span class='no'>xsi</span>    <span class='co'># item difficulties</span>
<span class='no'>mod2</span>$<span class='no'>B</span>      <span class='co'># item slopes</span>

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
   F=~ I1__I40
   F ~~ 1*F
   # item type of 2PL is the default for dichotomous data
   "</span>
<span class='co'># estimate model</span>
<span class='no'>mod2t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2t</span>)

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>#************************************************************</span>
<span class='co'># Model 2a: 2PL with fixed item difficulties and slopes from 'mod2'</span>
<span class='no'>xsi0</span> <span class='kw'>&lt;-</span> <span class='no'>mod2</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>
<span class='no'>xsi.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>:(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>xsi0</span>)), <span class='no'>xsi0</span> )
        <span class='co'># define vector with fixed item difficulties</span>
<span class='no'>mod2a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='no'>xsi.fixed</span>,
                 <span class='kw'>B</span><span class='kw'>=</span><span class='no'>mod2</span>$<span class='no'>B</span> <span class='co'># fix slopes</span>
            )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2a</span>)
<span class='no'>mod2a</span>$<span class='no'>B</span>     <span class='co'># inspect used slope matrix</span>

<span class='co'>#************************************************************</span>
<span class='co'># Model 3: constrained 2PL estimation</span>
<span class='co'># estimate item parameters in different slope groups</span>
<span class='co'># items 1-10, 21-30 group 1</span>
<span class='co'># items 11-20 group 2 and items 31-40 group 3</span>
<span class='no'>est.slope</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='fl'>40</span>)
<span class='no'>est.slope</span>[ <span class='fl'>11</span>:<span class='fl'>20</span> ] <span class='kw'>&lt;-</span> <span class='fl'>2</span>
<span class='no'>est.slope</span>[ <span class='fl'>31</span>:<span class='fl'>40</span> ] <span class='kw'>&lt;-</span> <span class='fl'>3</span>
<span class='no'>mod3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.rasch</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL.groups"</span>,
               <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='no'>est.slope</span> )
<span class='no'>mod3</span>$<span class='no'>B</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3</span>)

<span class='co'>#--- tamaan specification (A)</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
   F=~ lam1*I1__I10 + lam2*I11__I20 + lam1*I21__I30 + lam3*I31__I40;
   F ~~ 1*F
   "</span>
<span class='co'># estimate model</span>
<span class='no'>mod3tA</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3tA</span>)

<span class='co'>#--- tamaan specification (alternative B)</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
   F=~ a1__a40*I1__I40;
   F ~~ 1*F
 MODEL CONSTRAINT:
   a1__a10==lam1
   a11__a20==lam2
   a21__a30==lam1
   a31__a40==lam3
   "</span>
<span class='no'>mod3tB</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3tB</span>)

<span class='co'>#--- tamaan specification (alternative C using DO operator)</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
 LAVAAN MODEL:
 DO(1,10,1)
   F=~ lam1*I%
 DOEND
 DO(11,20,1)
   F=~ lam2*I%
 DOEND
 DO(21,30,1)
   F=~ lam1*I%
 DOEND
 DO(31,40,1)
   F=~ lam3*I%
 DOEND
   F ~~ 1*F
   "</span>
<span class='co'># estimate model</span>
<span class='no'>mod3tC</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>data.sim.rasch</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3tC</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 2: Unidimensional calibration with latent regressors</span>
<span class='co'>#############################################################################</span>

<span class='co'># (1) simulate data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>6778</span>)     <span class='co'># set simulation seed</span>
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>2000</span>          <span class='co'># number of persons</span>
<span class='co'># latent regressors Y</span>
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>1.5</span>), <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>.3</span> ) )
<span class='co'># simulate theta</span>
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span> ) + <span class='fl'>.4</span> * <span class='no'>Y</span>[,<span class='fl'>1</span>] + <span class='fl'>.2</span> * <span class='no'>Y</span>[,<span class='fl'>2</span>]  <span class='co'># latent regression model</span>
<span class='co'># number of items</span>
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>40</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>, <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='co'># simulate response matrix</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"I"</span>, <span class='fl'>1</span>:<span class='no'>I</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)

<span class='co'># (2) estimate model</span>
<span class='no'>mod2_1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2_1</span>)

<span class='co'># (3) setting initial values for beta coefficients</span>
<span class='co'>#   beta_2=.20, beta_3=.35 for dimension 1</span>
<span class='no'>beta.inits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>,<span class='fl'>3</span>), <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.2</span>, <span class='fl'>.35</span> ) )
<span class='no'>mod2_2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span>, <span class='kw'>beta.inits</span><span class='kw'>=</span><span class='no'>beta.inits</span>)

<span class='co'># (4) fix intercept to zero and third coefficient to .3</span>
<span class='no'>beta.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>.3</span> ) )
<span class='no'>mod2_3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='no'>beta.fixed</span> )

<span class='co'># (5) same model but with R regression formula for Y</span>
<span class='no'>dataY</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='no'>Y</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dataY</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Y1"</span>,<span class='st'>"Y2"</span>)
<span class='no'>mod2_4</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>dataY</span><span class='kw'>=</span><span class='no'>dataY</span>, <span class='kw'>formulaY</span><span class='kw'>=</span>~ <span class='no'>Y1</span>+<span class='no'>Y2</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2_4</span>)

<span class='co'># (6) model with interaction of regressors</span>
<span class='no'>mod2_5</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>dataY</span><span class='kw'>=</span><span class='no'>dataY</span>, <span class='kw'>formulaY</span><span class='kw'>=</span>~ <span class='no'>Y1</span>*<span class='no'>Y2</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2_5</span>)

<span class='co'># (7) no constraint on regressors (removing constraint from intercept)</span>
<span class='no'>mod2_6</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span> )

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 3: Multiple group estimation</span>
<span class='co'>#############################################################################</span>

<span class='co'># (1) simulate data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>6778</span>)
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>3000</span>
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>/<span class='fl'>2</span>,<span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>0</span>,<span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>1.5</span>), <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>/<span class='fl'>2</span>,<span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>.5</span>,<span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>1</span>)  )
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>20</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>, <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"I"</span>, <span class='fl'>1</span>:<span class='no'>I</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)
<span class='no'>group</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>, <span class='kw'>each</span><span class='kw'>=</span><span class='no'>N</span>/<span class='fl'>2</span> )

<span class='co'># (2) estimate model</span>
<span class='no'>mod3_1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>resp</span>,  <span class='kw'>group</span><span class='kw'>=</span><span class='no'>group</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3_1</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 4: Multidimensional estimation</span>
<span class='co'># with two dimensional theta's - simulate some bivariate data,</span>
<span class='co'># and regressors</span>
<span class='co'># 40 items: first 20 items load on dimension 1,</span>
<span class='co'>#           second 20 items load on dimension 2</span>
<span class='co'>#############################################################################</span>

<span class='co'># (1) simulate some data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>6778</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>mvtnorm</span>)
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>1000</span>
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span> ), <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>) )
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mvtnorm</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html'>rmvnorm</a></span>( <span class='no'>N</span>,<span class='kw'>mean</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>0</span>), <span class='kw'>sigma</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>.5</span>,<span class='fl'>.5</span>,<span class='fl'>1</span>), <span class='fl'>2</span>, <span class='fl'>2</span> ))
<span class='no'>theta</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>theta</span>[,<span class='fl'>1</span>] + <span class='fl'>.4</span> * <span class='no'>Y</span>[,<span class='fl'>1</span>] + <span class='fl'>.2</span> * <span class='no'>Y</span>[,<span class='fl'>2</span>]  <span class='co'># latent regression model</span>
<span class='no'>theta</span>[,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='no'>theta</span>[,<span class='fl'>2</span>] + <span class='fl'>.8</span> * <span class='no'>Y</span>[,<span class='fl'>1</span>] + <span class='fl'>.5</span> * <span class='no'>Y</span>[,<span class='fl'>2</span>]  <span class='co'># latent regression model</span>
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>20</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>[,<span class='fl'>1</span>], <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='no'>resp1</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>[,<span class='fl'>2</span>], <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='no'>resp2</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='no'>resp1</span>,<span class='no'>resp2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"I"</span>, <span class='fl'>1</span>:(<span class='fl'>2</span>*<span class='no'>I</span>), <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)

<span class='co'># (2) define loading Matrix</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>( <span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>2</span>*<span class='no'>I</span>, <span class='fl'>2</span> ))
<span class='no'>Q</span>[<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>1</span>:(<span class='fl'>2</span>*<span class='no'>I</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='no'>I</span>), <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>2</span>,<span class='no'>I</span>) ))] <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='co'># (3) estimate models</span>

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.1: Rasch model: without regressors</span>
<span class='no'>mod4_1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span> )

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    F1=~ 1*I1__I20
    F2=~ 1*I21__I40
    # Alternatively to the factor 1 one can use the item type Rasch
    F1 ~~ F1
    F2 ~~ F2
    F1 ~~ F2
    "</span>
<span class='no'>mod4_1t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>resp</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>100</span>))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4_1t</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.1b: estimate model with sum constraint of items for each dimension</span>
<span class='no'>mod4_1b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>,<span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.2: Rasch model: set covariance between dimensions to zero</span>
<span class='no'>variance_fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>0</span> )
<span class='no'>mod4_2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='no'>variance_fixed</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4_2</span>)

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    F1=~ I1__I20
    F2=~ I21__I40
    F1 ~~ F1
    F2 ~~ F2
    F1 ~~ 0*F2
  ITEM TYPE:
    ALL(Rasch)
    "</span>
<span class='no'>mod4_2t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>resp</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4_2t</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.3: 2PL model</span>
<span class='no'>mod4_3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span> )

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    F1=~ I1__I20
    F2=~ I21__I40
    F1 ~~ F1
    F2 ~~ F2
    F1 ~~ F2
    "</span>
<span class='no'>mod4_3t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>resp</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4_3t</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.4: Rasch model with 2000 quasi monte carlo nodes</span>
<span class='co'># -&gt; nodes are useful for more than 3 or 4 dimensions</span>
<span class='no'>mod4_4</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>) )

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.5: Rasch model with 2000 stochastic nodes</span>
<span class='no'>mod4_5</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>,<span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>,<span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>FALSE</span>))

<span class='co'>#************************************************************</span>
<span class='co'># Model 4.6: estimate two dimensional Rasch model with regressors</span>
<span class='no'>mod4_6</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span> )

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    F1=~ I1__I20
    F2=~ I21__I40
    F1 ~~ F1
    F2 ~~ F2
    F1 ~~ F2
  ITEM TYPE:
    ALL(Rasch)
    "</span>
<span class='no'>mod4_6t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>resp</span>, <span class='kw'>Y</span><span class='kw'>=</span><span class='no'>Y</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4_6t</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 5: 2-dimensional estimation with within item dimensionality</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>mvtnorm</span>)
<span class='co'># (1) simulate data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>4762</span>)
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>2000</span> <span class='co'># 2000 persons</span>
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span> )
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mvtnorm</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html'>rmvnorm</a></span>( <span class='no'>N</span>,<span class='kw'>mean</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>0</span>), <span class='kw'>sigma</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>.5</span>,<span class='fl'>.5</span>,<span class='fl'>1</span>), <span class='fl'>2</span>, <span class='fl'>2</span> ))
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>
<span class='co'># 10 items load on the first dimension</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>[,<span class='fl'>1</span>], <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='no'>resp1</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='co'># 10 items load on the second dimension</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='no'>theta</span>[,<span class='fl'>2</span>], <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span> ), <span class='st'>"-"</span> ) )
<span class='no'>resp2</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span> ) )
<span class='co'># 20 items load on both dimensions</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='fl'>0.5</span>*<span class='no'>theta</span>[,<span class='fl'>1</span>] + <span class='fl'>1.5</span>*<span class='no'>theta</span>[,<span class='fl'>2</span>], <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(-<span class='fl'>2</span>,<span class='fl'>2</span>,<span class='kw'>len</span><span class='kw'>=</span><span class='fl'>2</span>*<span class='no'>I</span> ), <span class='st'>"-"</span> ))
<span class='no'>resp3</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>p1</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='fl'>2</span>*<span class='no'>I</span> ), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span>*<span class='no'>I</span> ) )
<span class='co'>#Combine the two sets of items into one response matrix</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='no'>resp1</span>, <span class='no'>resp2</span>, <span class='no'>resp3</span> )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"I"</span>, <span class='fl'>1</span>:(<span class='fl'>4</span>*<span class='no'>I</span>), <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)

<span class='co'># (2) define loading matrix</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='fl'>10</span>),<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>0</span>,<span class='fl'>10</span>),<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='fl'>20</span>)), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>0</span>,<span class='fl'>10</span>),<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='fl'>10</span>),<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='fl'>20</span>)))

<span class='co'># (3) model: within item dimensionality and 2PL estimation</span>
<span class='no'>mod5</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod5</span>)

<span class='co'># item difficulties</span>
<span class='no'>mod5</span>$<span class='no'>item</span>
<span class='co'># item loadings</span>
<span class='no'>mod5</span>$<span class='no'>B</span>

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    F1=~ I1__I10 + I21__I40
    F2=~ I11__I20 + I21__I40
    F1 ~~ 1*F1
    F1 ~~ F2
    F2 ~~ 1*F2
    "</span>
<span class='no'>mod5t</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='no'>resp</span>,  <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>10</span>))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod5t</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 6: ordered data - Generalized partial credit model</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"TAM"</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Ex6.1: Nominal response model (irtmodel="2PL")</span>
<span class='no'>mod6_1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>200</span>) )
<span class='no'>mod6_1</span>$<span class='no'>item</span> <span class='co'># item intercepts</span>
<span class='no'>mod6_1</span>$<span class='no'>B</span>    <span class='co'># for every category a separate slope parameter is estimated</span>

<span class='co'># reestimate the model with fixed item parameters</span>
<span class='no'>mod6_1a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>,
       <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='no'>mod6_1</span>$<span class='no'>xsi.fixed.estimated</span>,  <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='no'>mod6_1</span>$<span class='no'>B.fixed.estimated</span>,
       <span class='kw'>est.variance</span><span class='kw'>=</span><span class='fl'>TRUE</span> )

<span class='co'># estimate the model with initial item parameters from mod6_1</span>
<span class='no'>mod6_1b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>,
       <span class='kw'>xsi.inits</span><span class='kw'>=</span><span class='no'>mod6_1</span>$<span class='no'>xsi.fixed.estimated</span>,  <span class='kw'>B</span><span class='kw'>=</span><span class='no'>mod6_1</span>$<span class='no'>B</span> )

<span class='co'>#************************************************************</span>
<span class='co'># Ex6.2: Generalized partial credit model</span>
<span class='no'>mod6_2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>200</span>))
<span class='no'>mod6_2</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,]    <span class='co'># joint slope parameter for all categories</span>

<span class='co'>#************************************************************</span>
<span class='co'># Ex6.3: some fixed entries of slope matrix B</span>
<span class='co'># B: nitems x maxK x ndim</span>
<span class='co'>#   ( number of items x maximum number of categories x number of dimensions)</span>
<span class='co'># set two constraints</span>
<span class='no'>B.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='fl'>2</span>, <span class='fl'>4</span> )
<span class='co'># set second item, score of 2 (category 3), at first dimension to 2.3</span>
<span class='no'>B.fixed</span>[<span class='fl'>1</span>,] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>1</span>,<span class='fl'>2.3</span>)
<span class='co'># set third item, score of 1 (category 2), at first dimension to 1.4</span>
<span class='no'>B.fixed</span>[<span class='fl'>2</span>,] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>3</span>,<span class='fl'>2</span>,<span class='fl'>1</span>,<span class='fl'>1.4</span>)

<span class='co'># estimate item parameter with variance fixed (by default)</span>
<span class='no'>mod6_3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>, <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='no'>B.fixed</span>,
                 <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>200</span>) )
<span class='no'>mod6_3</span>$<span class='no'>B</span>

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.4: estimate the same model, but estimate variance</span>
<span class='no'>mod6_4</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>, <span class='kw'>B.fixed</span><span class='kw'>=</span><span class='no'>B.fixed</span>,
               <span class='kw'>est.variance</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>350</span>) )
<span class='no'>mod6_4</span>$<span class='no'>B</span>

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.5: partial credit model</span>
<span class='no'>mod6_5</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>,<span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>200</span>) )
<span class='no'>mod6_5</span>$<span class='no'>B</span>

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.6: partial credit model: Conquest parametrization 'item+item*step'</span>
<span class='no'>mod6_6</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"PCM2"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_6</span>)

<span class='co'># estimate mod6_6 applying the sum constraint of item difficulties</span>
<span class='co'># modify design matrix of xsi paramters</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>.A.PCM2</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span> )
<span class='no'>A1</span>[<span class='fl'>3</span>,<span class='fl'>2</span>:<span class='fl'>4</span>,<span class='st'>"Comfort"</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>:<span class='fl'>3</span>
<span class='no'>A1</span>[<span class='fl'>3</span>,<span class='fl'>2</span>:<span class='fl'>4</span>,<span class='st'>"Work"</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>:<span class='fl'>3</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A1</span>[,, -<span class='fl'>3</span>] <span class='co'># remove Benefit xsi item parameter</span>
<span class='co'># estimate model</span>
<span class='no'>mod6_6b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_6b</span>)

<span class='co'># estimate model with argument constraint="items"</span>
<span class='no'>mod6_6c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"PCM2"</span>, <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span>)

<span class='co'># estimate mod6_6 using tam.mml.mfr</span>
<span class='no'>mod6_6d</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>formulaA</span><span class='kw'>=</span>~ <span class='fl'>0</span> + <span class='no'>item</span> + <span class='no'>item</span>:<span class='no'>step</span>,
    <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.1</span>), <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_6d</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.7: Rating scale model: Conquest parametrization 'item+step'</span>
<span class='no'>mod6_7</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.gpcm</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"RSM"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_7</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.8: sum constraint on item difficulties</span>
<span class='co'>#         partial credit model: ConQuest parametrization 'item+item*step'</span>
<span class='co'>#         polytomous scored TIMMS data</span>
<span class='co'>#         compare to Example 16</span>
<span class='co'>#</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.timssAusTwn.scored</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.timssAusTwn.scored</span>[,<span class='fl'>1</span>:<span class='fl'>11</span>]

<span class='co'>## &gt; tail(sort(names(dat)),1) # constrained item</span>
<span class='co'>## [1] "M032761"</span>

<span class='co'># modify design matrix of xsi paramters</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>.A.PCM2</a></span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span> )
<span class='co'># constrained item loads on every other main item parameter</span>
<span class='co'># with opposing margin it had been loaded on its own main item parameter</span>
<span class='no'>A1</span>[<span class='st'>"M032761"</span>,,<span class='fu'><a href='https://rdrr.io/r/base/sets.html'>setdiff</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>), <span class='st'>"M032761"</span>)] <span class='kw'>&lt;-</span> -<span class='no'>A1</span>[<span class='st'>"M032761"</span>,,<span class='st'>"M032761"</span>]
<span class='co'># remove main item parameter for constrained item</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A1</span>[,, <span class='fu'><a href='https://rdrr.io/r/base/sets.html'>setdiff</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]],<span class='st'>"M032761"</span>)]

<span class='co'># estimate model</span>
<span class='no'>mod6_8a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_8a</span>)
<span class='co'># extract fixed item parameter for item M032761</span>
<span class='co'>## - sum(mod6_8a$xsi[setdiff(colnames(dat), "M032761"),"xsi"])</span>

<span class='co'># estimate mod6_8a using tam.mml.mfr</span>
<span class='co'>## fixed a bug in 'tam.mml.mfr' for differing number of categories</span>
<span class='co'>## per item -&gt; now a xsi vector with parameter fixings to values</span>
<span class='co'>## of 99 is used</span>
<span class='no'>mod6_8b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>formulaA</span><span class='kw'>=</span>~ <span class='fl'>0</span> + <span class='no'>item</span> + <span class='no'>item</span>:<span class='no'>step</span>,
                        <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.1</span>), <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_8b</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.9: sum constraint on item difficulties for irtmodel="PCM"</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.timssAusTwn.scored</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.timssAusTwn.scored</span>[,<span class='fl'>2</span>:<span class='fl'>11</span>]
<span class='no'>dat</span>[ <span class='no'>dat</span><span class='kw'>==</span><span class='fl'>9</span> ] <span class='kw'>&lt;-</span> <span class='fl'>NA</span>

<span class='co'># obtain the design matrix for the PCM parametrization and</span>
<span class='co'># the number of categories for each item</span>
<span class='no'>maxKi</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>dat</span>, <span class='fl'>2</span>, <span class='no'>max</span>, <span class='kw'>na.rm</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>des</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>des</span>$<span class='no'>A</span>

<span class='co'># define the constrained item category and remove the respective parameter</span>
(<span class='no'>par</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]][<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>A1</span>)[<span class='fl'>3</span>]], <span class='kw'>split</span><span class='kw'>=</span><span class='st'>"_"</span>) ))
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A1</span>[,,-<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>A1</span>)[<span class='fl'>3</span>]]

<span class='co'># the item category loads on every other item category parameter with</span>
<span class='co'># opposing margin, balancing the number of categories for each item</span>
<span class='no'>item.id</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>)<span class='kw'>==</span><span class='no'>par</span>[<span class='fl'>1</span>])
<span class='no'>cat.id</span> <span class='kw'>&lt;-</span> <span class='no'>maxKi</span>[<span class='no'>par</span>[<span class='fl'>1</span>]]+<span class='fl'>1</span>
<span class='no'>loading</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>/<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='no'>maxKi</span>, <span class='no'>maxKi</span>)
<span class='no'>loading</span> <span class='kw'>&lt;-</span> <span class='no'>loading</span> [-<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>loading</span>)<span class='kw'>==</span><span class='no'>par</span>[<span class='fl'>1</span>])[<span class='fl'>1</span>]]
<span class='no'>A1</span>[<span class='no'>item.id</span>, <span class='no'>cat.id</span>, ] <span class='kw'>&lt;-</span> <span class='no'>loading</span>
<span class='no'>A1</span>[<span class='no'>item.id</span>,,]

<span class='co'># estimate model</span>
<span class='no'>mod6_9</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_9</span>)

<span class='co'>## extract fixed item category parameter</span>
<span class='co'># calculate mean for each item</span>
<span class='no'>ind.item.cat.pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>), <span class='no'>grep</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>mod6_8</span>$<span class='no'>xsi</span>))
<span class='no'>item.means</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>ind.item.cat.pars</span>, <span class='kw'>function</span>(<span class='no'>ii</span>) <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>mod6_8</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>[<span class='no'>ii</span>]))

<span class='co'># these sum up to the negative of the fixed parameter</span>
<span class='no'>fix.par</span> <span class='kw'>&lt;-</span> -<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>(<span class='no'>item.means</span>), <span class='kw'>na.rm</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'>#************************************************************</span>
<span class='co'># Ex 6.10: Generalized partial credit model with equality constraints</span>
<span class='co'>#          on item discriminations</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.gpcm</span>

<span class='co'># Ex 6.10a: set all slopes of three items equal to each other</span>
<span class='no'>E</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>1</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>1</span> )
<span class='no'>mod6_10a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM.design"</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E</span>  )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_10a</span>)
<span class='no'>mod6_10a</span>$<span class='no'>B</span>[,,]

<span class='co'># Ex 6.10b: equal slope for first and third item</span>
<span class='no'>E</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span> )
<span class='no'>E</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>),<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fl'>2</span>, <span class='fl'>2</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>mod6_10b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM.design"</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E</span>  )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6_10b</span>)
<span class='no'>mod6_10b</span>$<span class='no'>B</span>[,,]

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 7: design matrix for slopes for the generalized partial credit model</span>
<span class='co'>#############################################################################</span>

<span class='co'># (1) simulate data from a model with a (item slope) design matrix E</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>789</span>)
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>42</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span>)
<span class='co'># create design matrix for loadings</span>
<span class='no'>E</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='no'>I</span>, <span class='fl'>5</span> )
<span class='no'>E</span>[ <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>1</span>,<span class='no'>I</span>,<span class='fl'>3</span>), <span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>2</span>,<span class='no'>I</span>,<span class='fl'>3</span>), <span class='fl'>2</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>3</span>,<span class='no'>I</span>,<span class='fl'>3</span>), <span class='fl'>3</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>ind</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( <span class='fl'>1</span>, <span class='no'>I</span>, <span class='fl'>2</span> ) ; <span class='no'>E</span>[ <span class='no'>ind</span>, <span class='fl'>4</span> ] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>.3</span>, -<span class='fl'>.2</span> ), <span class='no'>I</span> )[ <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>ind</span>) ]
<span class='no'>ind</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>( <span class='fl'>2</span>, <span class='no'>I</span>, <span class='fl'>4</span> ) ; <span class='no'>E</span>[ <span class='no'>ind</span>, <span class='fl'>5</span> ] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>( <span class='fl'>.15</span>, <span class='no'>I</span> )[ <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>ind</span>) ]
<span class='no'>E</span>

<span class='co'># true basis slope parameters</span>
<span class='no'>lambda</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>1</span>, <span class='fl'>1.2</span>, <span class='fl'>0.8</span>, <span class='fl'>1</span>, <span class='fl'>1.1</span> )
<span class='co'># calculate item slopes</span>
<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>E</span> <span class='kw'>%*%</span> <span class='no'>lambda</span>

<span class='co'># simulate</span>
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>4000</span>
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>( <span class='no'>N</span> )
<span class='no'>aM</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='no'>N</span>), <span class='no'>a</span>[,<span class='fl'>1</span>] )
<span class='no'>bM</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>,<span class='no'>N</span>), <span class='no'>b</span> )
<span class='no'>pM</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span>( <span class='no'>aM</span> * ( <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='no'>theta</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span>  ) - <span class='no'>bM</span> ) )
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> * ( <span class='no'>pM</span> <span class='kw'>&gt;</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>( <span class='no'>N</span>*<span class='no'>I</span> ) )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"I"</span>, <span class='fl'>1</span>:<span class='no'>I</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>)

<span class='co'># estimate model</span>
<span class='no'>mod7</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM.design"</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E</span> )
<span class='no'>mod7</span>$<span class='no'>B</span>

<span class='co'># recalculate estimated basis parameters</span>
<span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>( <span class='no'>mod7</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,<span class='fl'>1</span>] ~ <span class='fl'>0</span>+ <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='no'>E</span> ) )
  <span class='co'>##   Call:</span>
  <span class='co'>##   lm(formula=mod7$B[, 2, 1] ~ 0 + as.matrix(E))</span>
  <span class='co'>##   Coefficients:</span>
  <span class='co'>##   as.matrix(E)1  as.matrix(E)2  as.matrix(E)3  as.matrix(E)4  as.matrix(E)5</span>
  <span class='co'>##          0.9904         1.1896         0.7817         0.9601         1.2132</span>

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 8: Differential item functioning                                  #</span>
<span class='co'>#  A first example of a Multifaceted Rasch Model                            #</span>
<span class='co'>#  Facet is only female; 10 items are studied                               #</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex08</span>)

<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span>+<span class='no'>female</span>+<span class='no'>item</span>*<span class='no'>female</span>
<span class='co'># this formula is in R equivalent to 'item*female'</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]
<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span>( <span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"facets"</span>]] )

<span class='co'>#***</span>
<span class='co'># Model 8a: investigate gender DIF on all items</span>
<span class='no'>mod8a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod8a</span>)

<span class='co'>#***</span>
<span class='co'># Model 8a 2: specification with long format response data</span>
<span class='no'>resp.long</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]] )
<span class='no'>pid</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>( <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]) )

<span class='no'>itemnames</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]), <span class='kw'>each</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]))
<span class='no'>facets.long</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>( <span class='st'>"item"</span><span class='kw'>=</span><span class='no'>itemnames</span> ),
                 <span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"facets"</span>]][<span class='no'>pid</span>,,<span class='kw'>drop</span><span class='kw'>=</span><span class='no'>F</span>] )

<span class='no'>mod8a_2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp.long</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets.long</span>,
                      <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>pid</span>)
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>mod8a</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span><span class='kw'>==</span><span class='no'>mod8a_2</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span>) )

<span class='co'>#***</span>
<span class='co'># Model 8b: Differential bundle functioning (DBF)</span>
<span class='co'>#   - investigate differential item functioning in item groups</span>

<span class='co'># modify pre-specified design matrix to define 'appropriate' DBF effects</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span>*<span class='no'>female</span>
<span class='no'>des</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices.mfr</a></span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>)
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>des</span>$<span class='no'>A</span>$<span class='no'>A.3d</span>
<span class='co'># item group A: items 1-5</span>
<span class='co'># item group B: items 6-8</span>
<span class='co'># item group C: items 9-10</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A1</span>[,,<span class='fl'>1</span>:<span class='fl'>13</span>]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]][ <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>12</span>,<span class='fl'>13</span>) ] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"A:female1"</span>, <span class='st'>"B:female1"</span>)
<span class='co'># item group A</span>
<span class='no'>A1</span>[,<span class='fl'>2</span>,<span class='fl'>12</span>] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>5</span>,<span class='fl'>7</span>,<span class='fl'>9</span>,<span class='fl'>11</span>),<span class='fl'>2</span>,<span class='fl'>12</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>5</span>,<span class='fl'>7</span>,<span class='fl'>9</span>,<span class='fl'>11</span>)+<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>12</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># item group B</span>
<span class='no'>A1</span>[,<span class='fl'>2</span>,<span class='fl'>13</span>] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>13</span>,<span class='fl'>15</span>,<span class='fl'>17</span>),<span class='fl'>2</span>,<span class='fl'>13</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>13</span>,<span class='fl'>15</span>,<span class='fl'>17</span>)+<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>13</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># item group C (define effect(A)+effect(B)+effect(C)=0)</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>19</span>,<span class='fl'>3</span>),<span class='fl'>2</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>12</span>,<span class='fl'>13</span>)] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>19</span>,<span class='fl'>3</span>)+<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>12</span>,<span class='fl'>13</span>)] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='co'>#   A1[,2,]   # look at modified design matrix</span>
<span class='co'># estimate model</span>
<span class='no'>mod8b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>des</span>$<span class='no'>gresp</span>$<span class='no'>gresp.noStep</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod8b</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 9: Multifaceted Rasch Model</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.sim.mfr</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.sim.facets</span>)

<span class='co'># two way interaction item and rater</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~<span class='no'>item</span>+<span class='no'>item</span>:<span class='no'>step</span> + <span class='no'>item</span>*<span class='no'>rater</span>
<span class='no'>mod9a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.mfr</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>data.sim.facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>)
<span class='no'>mod9a</span>$<span class='no'>xsi.facets</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod9a</span>)

<span class='co'># three way interaction item, female and rater</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~<span class='no'>item</span>+<span class='no'>item</span>:<span class='no'>step</span> + <span class='no'>female</span>*<span class='no'>rater</span> + <span class='no'>female</span>*<span class='no'>item</span>*<span class='no'>step</span>
<span class='no'>mod9b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.sim.mfr</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>data.sim.facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod9b</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 10: Model with raters.</span>
<span class='co'>#   Persons are arranged in multiple rows which is indicated</span>
<span class='co'>#   by multiple person identifiers.</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex10</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex10</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>dat</span>)
  <span class='co'>##     pid rater I0001 I0002 I0003 I0004 I0005</span>
  <span class='co'>## 1     1     1     0     1     1     0     0</span>
  <span class='co'>## 451   1     2     1     1     1     1     0</span>
  <span class='co'>## 901   1     3     1     1     1     0     1</span>
  <span class='co'>## 452   2     2     1     1     1     0     1</span>
  <span class='co'>## 902   2     3     1     1     0     1     1</span>

<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, <span class='st'>"rater"</span>, <span class='kw'>drop</span><span class='kw'>=</span><span class='fl'>FALSE</span> ] <span class='co'># define facet (rater)</span>
<span class='no'>pid</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>$<span class='no'>pid</span>      <span class='co'># define person identifier (a person occurs multiple times)</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>) ]        <span class='co'># item response data</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span> * <span class='no'>rater</span>      <span class='co'># formula</span>

<span class='no'>mod10</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod10</span>)

<span class='co'># estimate person parameter with WLE</span>
<span class='no'>wmod10</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.wle.html'>tam.wle</a></span>( <span class='no'>mod10</span> )

<span class='co'>#--- Example 10a</span>
<span class='co'># compare model containing only item</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span> + <span class='no'>rater</span>      <span class='co'># pseudo formula for item</span>
<span class='no'>xsi.setnull</span> <span class='kw'>&lt;-</span> <span class='st'>"rater"</span>          <span class='co'># set all rater effects to zero</span>
<span class='no'>mod10a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>,
            <span class='kw'>xsi.setnull</span><span class='kw'>=</span><span class='no'>xsi.setnull</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>0</span>))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod10a</span>)

<span class='co'># A shorter way for specifying this example is</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span> + <span class='fl'>0</span>*<span class='no'>rater</span>        <span class='co'># set all rater effects to zero</span>
<span class='no'>mod10a1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod10a1</span>)

<span class='co'># tam.mml.mfr also appropriately extends the facets data frame with pseudo facets</span>
<span class='co'># if necessary</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span>     <span class='co'># omitting the rater term</span>
<span class='no'>mod10a2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span> )
  <span class='co'>##   Item Parameters Xsi</span>
  <span class='co'>##              xsi se.xsi</span>
  <span class='co'>##   I0001   -1.931  0.111</span>
  <span class='co'>##   I0002   -1.023  0.095</span>
  <span class='co'>##   I0003   -0.089  0.089</span>
  <span class='co'>##   I0004    1.015  0.094</span>
  <span class='co'>##   I0005    1.918  0.110</span>
  <span class='co'>##   psfPF11  0.000  0.000</span>
  <span class='co'>##   psfPF12  0.000  0.000</span>

<span class='co'>#***</span>
<span class='co'># Model 10_2: specification with long format response data</span>
<span class='no'>resp.long</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>( <span class='no'>dat</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>) ] ))

<span class='no'>pid</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>( <span class='no'>dat</span>$<span class='no'>pid</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>) ]) )
<span class='no'>itemnames</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>) ]), <span class='kw'>each</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>dat</span>[, -<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>) ]))

<span class='co'># quick note: the 'trick' to use pid as the row index of the facet  (cf., used in Ex 8a_2)</span>
<span class='co'># is not working here, since pid already occures multiple times in the original response data</span>
<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='st'>"item"</span><span class='kw'>=</span><span class='no'>itemnames</span>),
                 <span class='no'>dat</span>[ <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>dat</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>[,-<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>)])), <span class='st'>"rater"</span>,<span class='kw'>drop</span><span class='kw'>=</span><span class='no'>F</span>]
)

<span class='no'>mod10_2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp.long</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>pid</span>)

<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>mod10</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span><span class='kw'>==</span><span class='no'>mod10_2</span>$<span class='no'>xsi.facets</span>$<span class='no'>xsi</span>) )

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 11: Dichotomous data with missing and omitted responses</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex11</span>) ; <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex11</span>

<span class='co'>#***</span>
<span class='co'># Model 11a: Calibration (item parameter estimating) in which omitted</span>
<span class='co'>#            responses (code 9) are set to missing</span>
<span class='no'>dat1</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[,-<span class='fl'>1</span>]
<span class='no'>dat1</span>[ <span class='no'>dat1</span><span class='kw'>==</span><span class='fl'>9</span> ] <span class='kw'>&lt;-</span> <span class='fl'>NA</span>
<span class='co'># estimate Rasch model</span>
<span class='no'>mod11a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat1</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod11a</span>)
<span class='co'># compute person parameters</span>
<span class='no'>wmod11a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.wle.html'>tam.wle</a></span>( <span class='no'>mod11a</span> )

<span class='co'>#***</span>
<span class='co'># Model 11b: Scaling persons (WLE estimation) setting omitted</span>
<span class='co'>#            responses as incorrect and using fixed</span>
<span class='co'>#            item parameters form Model 11a</span>

<span class='co'># set matrix with fixed item difficulties as the input</span>
<span class='no'>xsi1</span> <span class='kw'>&lt;-</span> <span class='no'>mod11a</span>$<span class='no'>xsi</span>    <span class='co'># xsi output from Model 11a</span>
<span class='no'>xsi.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>1</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>xsi1</span>) ), <span class='no'>xsi1</span>$<span class='no'>xsi</span> )
<span class='co'># recode 9 to 0</span>
<span class='no'>dat2</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[,-<span class='fl'>1</span>]
<span class='no'>dat2</span>[ <span class='no'>dat2</span><span class='kw'>==</span><span class='fl'>9</span> ] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
<span class='co'># run Rasch model with fixed item difficulties</span>
<span class='no'>mod11b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat2</span>, <span class='kw'>xsi.fixed</span><span class='kw'>=</span><span class='no'>xsi.fixed</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod11b</span>)
<span class='co'># WLE estimation</span>
<span class='no'>wmod11b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.wle.html'>tam.wle</a></span>( <span class='no'>mod11b</span> )

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 12: Avoiding nonconvergence using the argument increment.factor</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex12</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex12</span>

<span class='co'># non-convergence without increment.factor</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.ex12</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>1000</span>) )

<span class='co'># avoiding non-convergence with increment.factor=1.02</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.ex12</span>,
            <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>1000</span>, <span class='kw'>increment.factor</span><span class='kw'>=</span><span class='fl'>1.02</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 13: Longitudinal data 'data.long' from sirt package</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>sirt</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.long</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"sirt"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.long</span>
  <span class='co'>##   &gt; colnames(dat)</span>
  <span class='co'>##    [1] "idstud" "I1T1"   "I2T1"   "I3T1"   "I4T1"   "I5T1"   "I6T1"</span>
  <span class='co'>##    [8] "I3T2"   "I4T2"   "I5T2"   "I6T2"   "I7T2"   "I8T2"</span>

<span class='co'>## item 1 to 6 administered at T1 and items 3 to 8 at T2</span>
<span class='co'>## items 3 to 6 are anchor items</span>

<span class='co'>#***</span>
<span class='co'># Model 13a: 2-dimensional Rasch model assuming invariant item difficulties</span>

<span class='co'># define matrix loadings</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>,<span class='fl'>12</span>,<span class='fl'>2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>Q</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"T1"</span>,<span class='st'>"T2"</span>)
<span class='no'>Q</span>[<span class='fl'>1</span>:<span class='fl'>6</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>       <span class='co'># items at T1</span>
<span class='no'>Q</span>[<span class='fl'>7</span>:<span class='fl'>12</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>      <span class='co'># items at T2</span>

<span class='co'># assume equal item difficulty of I3T1 and I3T2, I4T1 and I4T2, ...</span>
<span class='co'># create draft design matrix and modify it</span>
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.long</span>[,-<span class='fl'>1</span>])$<span class='no'>A</span>
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>data.long</span>)[-<span class='fl'>1</span>]
  <span class='co'>##   &gt; str(A)</span>
  <span class='co'>##    num [1:12, 1:2, 1:12] 0 0 0 0 0 0 0 0 0 0 ...</span>
  <span class='co'>##    - attr(*, "dimnames")=List of 3</span>
  <span class='co'>##     ..$ : chr [1:12] "Item01" "Item02" "Item03" "Item04" ...</span>
  <span class='co'>##     ..$ : chr [1:2] "Category0" "Category1"</span>
  <span class='co'>##     ..$ : chr [1:12] "I1T1" "I2T1" "I3T1" "I4T1" ...</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A</span>[,, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>6</span>, <span class='fl'>11</span>:<span class='fl'>12</span> ) ]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/substr.html'>substring</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]],<span class='fl'>1</span>,<span class='fl'>2</span>)
<span class='no'>A1</span>[<span class='fl'>7</span>,<span class='fl'>2</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>     <span class='co'># difficulty(I3T1)=difficulty(I3T2)</span>
<span class='no'>A1</span>[<span class='fl'>8</span>,<span class='fl'>2</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>     <span class='co'># I4T1=I4T2</span>
<span class='no'>A1</span>[<span class='fl'>9</span>,<span class='fl'>2</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>10</span>,<span class='fl'>2</span>,<span class='fl'>6</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
  <span class='co'>##   &gt; A1[,2,]</span>
  <span class='co'>##        I1 I2 I3 I4 I5 I6 I7 I8</span>
  <span class='co'>##   I1T1 -1  0  0  0  0  0  0  0</span>
  <span class='co'>##   I2T1  0 -1  0  0  0  0  0  0</span>
  <span class='co'>##   I3T1  0  0 -1  0  0  0  0  0</span>
  <span class='co'>##   I4T1  0  0  0 -1  0  0  0  0</span>
  <span class='co'>##   I5T1  0  0  0  0 -1  0  0  0</span>
  <span class='co'>##   I6T1  0  0  0  0  0 -1  0  0</span>
  <span class='co'>##   I3T2  0  0 -1  0  0  0  0  0</span>
  <span class='co'>##   I4T2  0  0  0 -1  0  0  0  0</span>
  <span class='co'>##   I5T2  0  0  0  0 -1  0  0  0</span>
  <span class='co'>##   I6T2  0  0  0  0  0 -1  0  0</span>
  <span class='co'>##   I7T2  0  0  0  0  0  0 -1  0</span>
  <span class='co'>##   I8T2  0  0  0  0  0  0  0 -1</span>

<span class='co'># estimate model</span>
<span class='co'># set intercept of second dimension (T2) to zero</span>
<span class='no'>beta.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>0</span> )
<span class='no'>mod13a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.long</span>[,-<span class='fl'>1</span>], <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='no'>beta.fixed</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod13a</span>)

<span class='co'>#--- tamaan specification</span>
<span class='no'>tammodel</span> <span class='kw'>&lt;-</span> <span class='st'>"
  LAVAAN MODEL:
    T1=~ 1*I1T1__I6T1
    T2=~ 1*I3T2__I8T2
    T1 ~~ T1
    T2 ~~ T2
    T1 ~~ T2
    # constraint on item difficulties
    I3T1 + I3T2 | b3*t1
    I4T1 + I4T2 | b4*t1
    I5T1 + I5T2 | b5*t1
    I6T1 + I6T2 | b6*t1
    "</span>
<span class='co'># The constraint on item difficulties can be more efficiently written as</span>
  <span class='co'>##       DO(3,6,1)</span>
  <span class='co'>##         I%T1 + I%T2 | b%*t1</span>
  <span class='co'>##       DOEND</span>
<span class='co'># estimate model</span>
<span class='no'>mod13at</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tamaan.html'>tamaan</a></span>( <span class='no'>tammodel</span>, <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.long</span>,  <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='no'>beta.fixed</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod13at</span>)

<span class='co'>#***</span>
<span class='co'># Model 13b: invariant item difficulties with zero mean item difficulty</span>
<span class='co'>#           of anchor items</span>

<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.long</span>[,-<span class='fl'>1</span>])$<span class='no'>A</span>
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>data.long</span>)[-<span class='fl'>1</span>]
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A</span>[,, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>5</span>, <span class='fl'>11</span>:<span class='fl'>12</span> ) ]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/substr.html'>substring</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]],<span class='fl'>1</span>,<span class='fl'>2</span>)
<span class='no'>A1</span>[<span class='fl'>7</span>,<span class='fl'>2</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>     <span class='co'># difficulty(I3T1)=difficulty(I3T2)</span>
<span class='no'>A1</span>[<span class='fl'>8</span>,<span class='fl'>2</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>     <span class='co'># I4T1=I4T2</span>
<span class='no'>A1</span>[<span class='fl'>9</span>,<span class='fl'>2</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fl'>6</span>,<span class='fl'>2</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>6</span>,<span class='fl'>2</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>6</span>,<span class='fl'>2</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>     <span class='co'># I6T1=-(I3T1+I4T1+I5T1)</span>
<span class='no'>A1</span>[<span class='fl'>10</span>,<span class='fl'>2</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>10</span>,<span class='fl'>2</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>10</span>,<span class='fl'>2</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>  <span class='co'># I6T2=-(I3T2+I4T2+I5T2)</span>
<span class='no'>A1</span>[,<span class='fl'>2</span>,]
  <span class='co'>##      I1 I2 I3 I4 I5 I7 I8</span>
  <span class='co'>## I1T1 -1  0  0  0  0  0  0</span>
  <span class='co'>## I2T1  0 -1  0  0  0  0  0</span>
  <span class='co'>## I3T1  0  0 -1  0  0  0  0</span>
  <span class='co'>## I4T1  0  0  0 -1  0  0  0</span>
  <span class='co'>## I5T1  0  0  0  0 -1  0  0</span>
  <span class='co'>## I6T1  0  0  1  1  1  0  0</span>
  <span class='co'>## I3T2  0  0 -1  0  0  0  0</span>
  <span class='co'>## I4T2  0  0  0 -1  0  0  0</span>
  <span class='co'>## I5T2  0  0  0  0 -1  0  0</span>
  <span class='co'>## I6T2  0  0  1  1  1  0  0</span>
  <span class='co'>## I7T2  0  0  0  0  0 -1  0</span>
  <span class='co'>## I8T2  0  0  0  0  0  0 -1</span>

<span class='no'>mod13b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data.long</span>[,-<span class='fl'>1</span>], <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod13b</span>)

<span class='co'>#***</span>
<span class='co'># Model 13c: longitudinal polytomous data</span>
<span class='co'>#</span>

<span class='co'># modifiy Items I1T1, I4T1, I4T2 in order to be trichotomous (codes: 0,1,2)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>42</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.long</span>
<span class='no'>dat</span>[(<span class='fl'>1</span>:<span class='fl'>50</span>),<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='fl'>50</span>, <span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>dat</span>[(<span class='fl'>1</span>:<span class='fl'>50</span>),<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='fl'>50</span>, <span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>dat</span>[(<span class='fl'>1</span>:<span class='fl'>50</span>),<span class='fl'>9</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='fl'>50</span>, <span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
  <span class='co'>##   &gt; colnames(dat)</span>
  <span class='co'>##    [1] "idstud" "I1T1"   "I2T1"   "I3T1"   "I4T1"   "I5T1"   "I6T1"</span>
  <span class='co'>##    [8] "I3T2"   "I4T2"   "I5T2"   "I6T2"   "I7T2"   "I8T2"</span>

<span class='co'>## item 1 to 6 administered at T1, items 3 to 8 at T2</span>
<span class='co'>## items 3 to 6 are anchor items</span>

<span class='co'># (1) define matrix loadings</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>,<span class='fl'>12</span>,<span class='fl'>2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>Q</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"T1"</span>,<span class='st'>"T2"</span>)
<span class='no'>Q</span>[<span class='fl'>1</span>:<span class='fl'>6</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>       <span class='co'># items at T1</span>
<span class='no'>Q</span>[<span class='fl'>7</span>:<span class='fl'>12</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>      <span class='co'># items at T2</span>

<span class='co'># (2) assume equal item difficulty of anchor items</span>
<span class='co'>#     create draft design matrix and modify it</span>
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>[,-<span class='fl'>1</span>])$<span class='no'>A</span>
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>)[-<span class='fl'>1</span>]
  <span class='co'>## &gt; str(A)</span>
  <span class='co'>## num [1:12, 1:3, 1:15] 0 0 0 0 0 0 0 0 0 0 ...</span>
  <span class='co'>## - attr(*, "dimnames")=List of 3</span>
  <span class='co'>## ..$ : chr [1:12] "I1T1" "I2T1" "I3T1" "I4T1" ...</span>
  <span class='co'>## ..$ : chr [1:3] "Category0" "Category1" "Category2"</span>
  <span class='co'>## ..$ : chr [1:15] "I1T1_Cat1" "I1T1_Cat2" "I2T1_Cat1" "I3T1_Cat1" ...</span>

<span class='co'># define matrix A</span>
<span class='co'># Items 1 to 3 administered at T1, Items 3 to 6 are anchor items</span>
<span class='co'># Item 7 to 8 administered at T2</span>
<span class='co'># Item I1T1, I4T1, I4T2 are trichotomous (codes: 0,1,2)</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A</span>[,, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>8</span>, <span class='fl'>14</span>:<span class='fl'>15</span>) ]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span>(<span class='st'>"T1|T2"</span>, <span class='st'>""</span>,  <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]])

<span class='co'># Modifications are shortened compared to Model 13 a, but are still valid</span>
<span class='no'>A1</span>[<span class='fl'>7</span>,,] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>3</span>,,]  <span class='co'># item 7, i.e. I3T2, loads on same parameters as</span>
                    <span class='co'># item 3, I3T1</span>
<span class='no'>A1</span>[<span class='fl'>8</span>,,] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>4</span>,,]  <span class='co'># same for item 8 and item 4</span>
<span class='no'>A1</span>[<span class='fl'>9</span>,,] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>5</span>,,]  <span class='co'># same for item 9 and item 5</span>
<span class='no'>A1</span>[<span class='fl'>10</span>,,] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>6</span>,,] <span class='co'># same for item 10 and item 6</span>
  <span class='co'>## &gt; A1[8,,]</span>
  <span class='co'>##           I1_Cat1 I1_Cat2 I2_Cat1 I3_Cat1 I4_Cat1 I4_Cat2 I5_Cat1 ...</span>
  <span class='co'>## Category0       0       0       0       0       0       0       0</span>
  <span class='co'>## Category1       0       0       0       0      -1       0       0</span>
  <span class='co'>## Category2       0       0       0       0      -1      -1       0</span>

<span class='co'># (3) estimate model</span>
<span class='co'>#     set intercept of second dimension (T2) to zero</span>
<span class='no'>beta.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>0</span> )
<span class='no'>mod13c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>[,-<span class='fl'>1</span>], <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='no'>beta.fixed</span>,
                   <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"PCM"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod13c</span>)
<span class='no'>wle.mod13c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.wle.html'>tam.wle</a></span>(<span class='no'>mod13c</span>) <span class='co'># WLEs of dimension T1 and T2</span>

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 14: Facet model with latent regression</span>
<span class='co'>#############################################################################</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>( <span class='no'>data.ex14</span> )
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex14</span>

<span class='co'>#***</span>
<span class='co'># Model 14a: facet model</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"crit"</span>,<span class='fl'>1</span>:<span class='fl'>7</span>,<span class='kw'>sep</span><span class='kw'>=</span><span class='st'>""</span>) ]    <span class='co'># item data</span>
<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>( <span class='st'>"rater"</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>rater</span> )     <span class='co'># define facets</span>
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~<span class='no'>item</span>+<span class='no'>item</span>*<span class='no'>step</span> + <span class='no'>rater</span>
<span class='no'>mod14a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod14a</span>)

<span class='co'>#***</span>
<span class='co'># Model 14b: facet model with latent regression</span>
<span class='co'>#   Note that dataY must correspond to rows in resp and facets which means</span>
<span class='co'>#   that there must be the same rows in Y for a person with multiple rows</span>
<span class='co'>#   in resp</span>
<span class='no'>dataY</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"X1"</span>,<span class='st'>"X2"</span>) ]        <span class='co'># latent regressors</span>
<span class='no'>formulaY</span> <span class='kw'>&lt;-</span> ~ <span class='no'>X1</span>+<span class='no'>X2</span>            <span class='co'># latent regression formula</span>
<span class='no'>mod14b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>( <span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>,
            <span class='kw'>dataY</span><span class='kw'>=</span><span class='no'>dataY</span>, <span class='kw'>formulaY</span><span class='kw'>=</span><span class='no'>formulaY</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>pid</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod14b</span>)

<span class='co'>#***</span>
<span class='co'># Model 14c: Multi-facet model with item slope estimation</span>
<span class='co'># use design matrix and modified response data from Model 1</span>
<span class='co'># item-specific slopes</span>

<span class='no'>resp1</span> <span class='kw'>&lt;-</span> <span class='no'>mod14a</span>$<span class='no'>resp</span>      <span class='co'># extract response data with generalized items</span>
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='no'>mod14a</span>$<span class='no'>A</span>             <span class='co'># extract design matrix for item intercepts</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp1</span>)

<span class='co'># define design matrix for slopes</span>
<span class='no'>E</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>resp1</span>), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>7</span> )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>E</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"crit"</span>,<span class='fl'>1</span>:<span class='fl'>7</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>E</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp1</span>)
<span class='no'>E</span>[ <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='fl'>1</span>:(<span class='fl'>7</span>*<span class='fl'>7</span>), <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>:<span class='fl'>7</span>,<span class='kw'>each</span><span class='kw'>=</span><span class='fl'>7</span>) ) ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='no'>mod14c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp1</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM.design"</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E</span>,
        <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>100</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod14c</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 15: Coping with nonconvergent models</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex15</span>)
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex15</span>
<span class='co'># facet model 'group*item' is of interest</span>

<span class='co'>#***</span>
<span class='co'># Model 15a:</span>
<span class='no'>mod15a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data</span>[,-<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>)],<span class='kw'>facets</span><span class='kw'>=</span><span class='no'>data</span>[,<span class='st'>"group"</span>,<span class='kw'>drop</span><span class='kw'>=</span><span class='fl'>FALSE</span>],
    <span class='kw'>formulaA</span><span class='kw'>=</span>~ <span class='no'>item</span> + <span class='no'>group</span>*<span class='no'>item</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>pid</span> )
<span class='co'># See output:</span>
  <span class='co'>##</span>
  <span class='co'>##   Iteration 47     2013-09-10 16:51:39</span>
  <span class='co'>##   E Step</span>
  <span class='co'>##   M Step Intercepts   |----</span>
  <span class='co'>##     Deviance=75510.2868 | Deviance change: -595.0609</span>
  <span class='co'>##   !!! Deviance increases!                                        !!!!</span>
  <span class='co'>##   !!! Choose maybe fac.oldxsi &gt; 0 and/or increment.factor &gt; 1    !!!!</span>
  <span class='co'>##     Maximum intercept parameter change: 0.925045</span>
  <span class='co'>##     Maximum regression parameter change: 0</span>
  <span class='co'>##     Variance:  0.9796  | Maximum change: 0.009226</span>

<span class='co'>#***</span>
<span class='co'># Model 15b: Follow the suggestions of changing the default of fac.oldxsi and</span>
<span class='co'>#            increment.factor</span>
<span class='no'>mod15b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data</span>[,-<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>)],<span class='kw'>facets</span><span class='kw'>=</span><span class='no'>data</span>[,<span class='st'>"group"</span>,<span class='kw'>drop</span><span class='kw'>=</span><span class='fl'>FALSE</span>],
            <span class='kw'>formulaA</span><span class='kw'>=</span>~ <span class='no'>group</span>*<span class='no'>item</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>pid</span>,
            <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>increment.factor</span><span class='kw'>=</span><span class='fl'>1.03</span>, <span class='kw'>fac.oldxsi</span><span class='kw'>=</span><span class='fl'>.4</span> ) )

<span class='co'>#***</span>
<span class='co'># Model 15c: Alternatively, just choose more iterations in M-step by "Msteps=10"</span>
<span class='no'>mod15c</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>data</span>[,-<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>)],<span class='kw'>facets</span><span class='kw'>=</span><span class='no'>data</span>[,<span class='st'>"group"</span>,<span class='kw'>drop</span><span class='kw'>=</span><span class='fl'>FALSE</span>],
    <span class='kw'>formulaA</span><span class='kw'>=</span>~ <span class='no'>item</span> + <span class='no'>group</span>*<span class='no'>item</span>, <span class='kw'>pid</span><span class='kw'>=</span><span class='no'>data</span>$<span class='no'>pid</span>,
    <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>250</span>, <span class='kw'>Msteps</span><span class='kw'>=</span><span class='fl'>10</span>))

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 16: Differential item function for polytomous items and</span>
<span class='co'>#             differing number of response options per item</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.timssAusTwn.scored</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.timssAusTwn.scored</span>
<span class='co'># extract item response data</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"M"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>data.timssAusTwn.scored</span>), <span class='kw'>value</span><span class='kw'>=</span><span class='fl'>TRUE</span>)) ]
<span class='co'># some descriptives</span>
<span class='kw pkg'>psych</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/psych/man/describe.html'>describe</a></span>(<span class='no'>resp</span>)
<span class='co'># define facets: 'cnt' is group identifier</span>
<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>( <span class='st'>"cnt"</span><span class='kw'>=</span><span class='no'>dat</span>$<span class='no'>IDCNTRY</span>)
<span class='co'># create design matrices</span>
<span class='no'>des2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices.mfr2</a></span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>,
                   <span class='kw'>formulaA</span><span class='kw'>=</span>~<span class='no'>item</span>*<span class='no'>step</span> + <span class='no'>item</span>*<span class='no'>cnt</span>)
<span class='co'># restructured data set: pseudoitem=item x country</span>
<span class='no'>resp2</span> <span class='kw'>&lt;-</span> <span class='no'>des2</span>$<span class='no'>gresp</span>$<span class='no'>gresp.noStep</span>
<span class='co'># A design matrix</span>
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='no'>des2</span>$<span class='no'>A</span>$<span class='no'>A.3d</span>
    <span class='co'># redundant xsi parameters must be eliminated from design matrix</span>
<span class='no'>xsi.elim</span> <span class='kw'>&lt;-</span> <span class='no'>des2</span>$<span class='no'>xsi.elim</span>
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='no'>A</span>[,, - <span class='no'>xsi.elim</span>[,<span class='fl'>2</span>] ]
<span class='co'># extract loading matrix B</span>
<span class='no'>B</span> <span class='kw'>&lt;-</span> <span class='no'>des2</span>$<span class='no'>B</span>$<span class='no'>B.3d</span>
<span class='co'># estimate model</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp2</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='no'>B</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>100</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)
<span class='co'># The sum of all DIF parameters is set to zero. The DIF parameter for the last</span>
<span class='co'># item is therefore obtained</span>
<span class='no'>xsi1</span> <span class='kw'>&lt;-</span> <span class='no'>mod1</span>$<span class='no'>xsi</span>
<span class='no'>difxsi</span> <span class='kw'>&lt;-</span> <span class='no'>xsi1</span>[ <span class='fu'><a href='https://rdrr.io/r/base/sets.html'>intersect</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"cnt"</span>,<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>xsi1</span>)),
              <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"M03"</span>,<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>xsi1</span>))), ]   - <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span>(<span class='no'>difxsi</span>)
    <span class='co'># this is the DIF effect of the remaining item</span>

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 17: Several multidimensional and subdimension models</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>mirt</span>)
<span class='co'>#*** (1) simulate data in mirt package</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>9897</span>)
<span class='co'># simulate data according to the four-dimensional Rasch model</span>
<span class='co'># variances</span>
<span class='no'>variances</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>1.45</span>, <span class='fl'>1.74</span>, <span class='fl'>.86</span>, <span class='fl'>1.48</span>  )
<span class='co'># correlations</span>
<span class='no'>corrs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>4</span> )
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.88</span>
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.85</span>
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>4</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.87</span>
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.84</span>
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>4</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.90</span>
<span class='no'>dd1</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span> ; <span class='no'>dd2</span> <span class='kw'>&lt;-</span> <span class='fl'>4</span> ; <span class='no'>corrs</span>[<span class='no'>dd1</span>,<span class='no'>dd2</span>] <span class='kw'>&lt;-</span> <span class='no'>corrs</span>[<span class='no'>dd2</span>,<span class='no'>dd1</span>] <span class='kw'>&lt;-</span> <span class='fl'>.90</span>
<span class='co'># covariance matrix</span>
<span class='no'>covar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>( <span class='no'>variances</span>), <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>variances</span>) )*<span class='no'>corrs</span>
<span class='co'># item thresholds and item discriminations</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fl'>40</span>, -<span class='fl'>2</span>, <span class='fl'>2</span> ), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>1</span> )
<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>NA</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>40</span>,<span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>4</span>)
<span class='no'>a</span>[<span class='fl'>1</span>:<span class='fl'>10</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>a</span>[<span class='fl'>11</span>:<span class='fl'>20</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='no'>a</span>[<span class='fl'>21</span>:<span class='fl'>30</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='no'>a</span>[<span class='fl'>31</span>:<span class='fl'>40</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># simulate data</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mirt</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mirt/man/simdata.html'>simdata</a></span>(<span class='kw'>a</span><span class='kw'>=</span><span class='no'>a</span>, <span class='kw'>d</span><span class='kw'>=</span><span class='no'>d</span>, <span class='kw'>N</span><span class='kw'>=</span><span class='fl'>1000</span>, <span class='kw'>itemtype</span><span class='kw'>=</span><span class='st'>"dich"</span>, <span class='kw'>sigma</span><span class='kw'>=</span><span class='no'>covar</span> )
<span class='co'># define Q-matrix for testlet and subdimension models estimated below</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>40</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>5</span> )
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>Q</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"g"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='st'>"subd"</span>, <span class='fl'>1</span>:<span class='fl'>4</span>) )
<span class='no'>Q</span>[,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>Q</span>[<span class='fl'>1</span>:<span class='fl'>10</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='no'>Q</span>[<span class='fl'>11</span>:<span class='fl'>20</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='no'>Q</span>[<span class='fl'>21</span>:<span class='fl'>30</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> <span class='no'>Q</span>[<span class='fl'>31</span>:<span class='fl'>40</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='co'># define maximum number of iterations and number of quasi monte carlo nodes</span>
<span class='co'># maxit &lt;- 5  ; snodes &lt;- 300    # this specification is only for speed reasons</span>
<span class='no'>maxit</span> <span class='kw'>&lt;-</span> <span class='fl'>200</span> ; <span class='no'>snodes</span> <span class='kw'>&lt;-</span> <span class='fl'>1500</span>

<span class='co'>#*****************</span>
<span class='co'># Model 1: Rasch testlet model</span>
<span class='co'>#*****************</span>

<span class='co'># define a user function for restricting the variance according to the</span>
<span class='co'># Rasch testlet model</span>
<span class='no'>variance.fct1</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>variance</span> ){
            <span class='no'>ndim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance.new</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='no'>ndim</span>, <span class='no'>ndim</span> )
            <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance.new</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance</span> <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>
            <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>variance</span>)
                    }
<span class='no'>variance.Npars</span> <span class='kw'>&lt;-</span> <span class='fl'>5</span>    <span class='co'># number of estimated parameters in variance matrix</span>
<span class='co'># estimation using tam.mml</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='no'>variance.fct1</span>,
             <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='no'>variance.Npars</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>,
                          <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span>))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'>#*****************</span>
<span class='co'># Model 2: Testlet model with correlated testlet effects</span>
<span class='co'>#*****************</span>

<span class='co'># specify a testlet model with general factor g and testlet effects</span>
<span class='co'># u_1,u_2,u_3 and u_4. Assume that Cov(g,u_t)=0 for all t=1,2,3,4.</span>
<span class='co'># Additionally, assume that \sum_t,t' Cov( u_t, u_t')=0, i.e.</span>
<span class='co'># the sum of all testlet covariances is equal to zero</span>
<span class='co'>#=&gt; testlet effects are uncorrelated on average.</span>

<span class='co'># set Cov(g,u_t)=0 and sum of all testlet covariances equals to zero</span>
<span class='no'>variance.fct2</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>variance</span> ){
            <span class='no'>ndim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance.new</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='no'>ndim</span>, <span class='no'>ndim</span> )
            <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance.new</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance.new</span>[<span class='fl'>1</span>,<span class='fl'>2</span>:<span class='no'>ndim</span>] <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>[<span class='fl'>2</span>:<span class='no'>ndim</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
            <span class='co'># calculate average covariance between testlets</span>
            <span class='no'>v1</span> <span class='kw'>&lt;-</span> <span class='no'>variance</span>[ -<span class='fl'>1</span>, -<span class='fl'>1</span>] - <span class='no'>variance.new</span>[-<span class='fl'>1</span>,-<span class='fl'>1</span>]
            <span class='no'>M1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v1</span>) / ( ( <span class='no'>ndim</span>-<span class='fl'>1</span>)^<span class='fl'>2</span> - ( <span class='no'>ndim</span> - <span class='fl'>1</span>))
            <span class='no'>v1</span> <span class='kw'>&lt;-</span> <span class='no'>v1</span> - <span class='no'>M1</span>
            <span class='no'>variance.new</span>[ -<span class='fl'>1</span>, -<span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='no'>v1</span>
            <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance.new</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance</span> <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>
            <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>variance</span>)
                    }
<span class='no'>variance.Npars</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='fl'>4</span> + (<span class='fl'>4</span>*<span class='fl'>3</span>)/<span class='fl'>2</span> - <span class='fl'>1</span>
<span class='co'># estimate model in TAM</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='no'>variance.fct2</span>,
                <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='no'>variance.Npars</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)

<span class='co'>#*****************</span>
<span class='co'># Model 3: Testlet model with correlated testlet effects (different identification)</span>
<span class='co'>#*****************</span>

<span class='co'># Testlet model like in Model 2. But now the constraint is</span>
<span class='co'># \sum _t,t' Cov(u_t, u_t') + \sum_t Var(u_t)=0, i.e.</span>
<span class='co'># the sum of all testlet covariances and variances is equal to zero.</span>
<span class='no'>variance.fct3</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>variance</span> ){
            <span class='no'>ndim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance.new</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>, <span class='no'>ndim</span>, <span class='no'>ndim</span> )
            <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance.new</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance</span>)
            <span class='no'>variance.new</span>[<span class='fl'>1</span>,<span class='fl'>2</span>:<span class='no'>ndim</span>] <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>[<span class='fl'>2</span>:<span class='no'>ndim</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
            <span class='co'># calculate average covariance and variance between testlets</span>
            <span class='no'>v1</span> <span class='kw'>&lt;-</span> <span class='no'>variance</span>[ -<span class='fl'>1</span>, -<span class='fl'>1</span>]
            <span class='no'>M1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>v1</span>)
            <span class='no'>v1</span> <span class='kw'>&lt;-</span> <span class='no'>v1</span> - <span class='no'>M1</span>
            <span class='no'>variance.new</span>[ -<span class='fl'>1</span>, -<span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='no'>v1</span>
            <span class='co'># ensure positive definiteness of covariance matrix</span>
            <span class='no'>eps</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>^(-<span class='fl'>2</span>)
            <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='no'>variance.new</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>( <span class='no'>variance.new</span>) + <span class='no'>eps</span>
            <span class='no'>variance.new</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>psych</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/psych/man/cor.smooth.html'>cor.smooth</a></span>( <span class='no'>variance.new</span> )  <span class='co'># smoothing in psych</span>
            <span class='no'>variance</span> <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>
            <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>variance</span>)
                    }
<span class='no'>variance.Npars</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='fl'>4</span> + (<span class='fl'>4</span>*<span class='fl'>3</span>)/<span class='fl'>2</span> - <span class='fl'>1</span>
<span class='co'># estimate model in TAM</span>
<span class='no'>mod3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='no'>variance.fct3</span>,
                <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='no'>variance.Npars</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3</span>)

<span class='co'>#*****************</span>
<span class='co'># Model 4: Rasch subdimension model</span>
<span class='co'>#*****************</span>

<span class='co'># The Rasch subdimension model is specified according to Brandt (2008).</span>
<span class='co'># The fourth testlet effect is defined as u4=- (u1+u2+u3)</span>
<span class='co'># specify an alternative Q-matrix with 4 dimensions</span>
<span class='no'>Q2</span> <span class='kw'>&lt;-</span> <span class='no'>Q</span>[,-<span class='fl'>5</span>]
<span class='no'>Q2</span>[<span class='fl'>31</span>:<span class='fl'>40</span>,<span class='fl'>2</span>:<span class='fl'>4</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>

<span class='co'># set Cov(g,u1)=Cov(g,u2)=Cov(g,u3)=0</span>
<span class='no'>variance.fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>0</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>0</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>0</span>) )
<span class='co'># estimate model in TAM</span>
<span class='no'>mod4</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q2</span>,<span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='no'>variance.fixed</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod4</span>)

<span class='co'>#*****************</span>
<span class='co'># Model 5: Higher-order model</span>
<span class='co'>#*****************</span>

<span class='co'># A four-dimensional model with a higher-order factor is specified.</span>
<span class='co'># F_t=a_t g + eps_g</span>
<span class='no'>Q3</span> <span class='kw'>&lt;-</span> <span class='no'>Q</span>[,-<span class='fl'>1</span>]
<span class='co'># define fitting function using the lavaan package and ULS estimation</span>
<span class='no'>N0</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>dat</span>)         <span class='co'># sample size of dataset</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>lavaan</span>)        <span class='co'># requires lavaan package for fitting covariance</span>
<span class='no'>variance.fct5</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>variance</span> ){
    <span class='no'>ndim</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>variance</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>variance</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>variance</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"F"</span>,<span class='fl'>1</span>:<span class='no'>ndim</span>)
    <span class='no'>lavmodel</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(
        <span class='st'>"FHO=~"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='st'>"F"</span>, <span class='fl'>1</span>:<span class='no'>ndim</span> ), <span class='kw'>collapse</span><span class='kw'>=</span><span class='st'>"+"</span> ) )
    <span class='no'>lavres</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lavaan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lavaan/man/cfa.html'>cfa</a></span>( <span class='kw'>model</span><span class='kw'>=</span><span class='no'>lavmodel</span>, <span class='kw'>sample.cov</span><span class='kw'>=</span><span class='no'>variance</span>, <span class='kw'>estimator</span><span class='kw'>=</span><span class='st'>"ULS"</span>,
                       <span class='kw'>std.lv</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>sample.nobs</span><span class='kw'>=</span><span class='no'>N0</span>)
    <span class='no'>variance.new</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span>(<span class='no'>lavres</span>)$<span class='no'>cov</span>
    <span class='no'>variance</span> <span class='kw'>&lt;-</span> <span class='no'>variance.new</span>
    <span class='co'># print coefficients</span>
    <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='st'>"\n **** Higher order loadings: "</span>,
            <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>( <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>lavres</span>)[ <span class='fl'>1</span>:<span class='no'>ndim</span> ], <span class='fl'>3</span> )), <span class='kw'>collapse</span><span class='kw'>=</span><span class='st'>" "</span>)
                        ), <span class='st'>"\n"</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>variance</span>)
                    }
<span class='no'>variance.Npars</span> <span class='kw'>&lt;-</span> <span class='fl'>4</span>+<span class='fl'>4</span>
<span class='co'># estimate model in TAM</span>
<span class='no'>mod5</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q3</span>, <span class='kw'>userfct.variance</span><span class='kw'>=</span><span class='no'>variance.fct5</span>,
                <span class='kw'>variance.Npars</span><span class='kw'>=</span><span class='no'>variance.Npars</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod5</span>)

<span class='co'>#*****************</span>
<span class='co'># Model 6: Generalized Rasch subdimension model (Brandt, 2012)</span>
<span class='co'>#*****************</span>

<span class='no'>Q2</span> <span class='kw'>&lt;-</span> <span class='no'>Q</span>[,-<span class='fl'>5</span>]
<span class='no'>Q2</span>[<span class='fl'>31</span>:<span class='fl'>40</span>,<span class='fl'>2</span>:<span class='fl'>4</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='co'># fixed covariances</span>
<span class='no'>variance.fixed2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>0</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>0</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>0</span>)  )
<span class='co'># design matrix for item loading parameters</span>
<span class='co'>#      items x category x dimension x xsi parameter</span>
<span class='no'>E</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>( <span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fl'>40</span>, <span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>4</span> ) )
<span class='no'>E</span>[ <span class='fl'>1</span>:<span class='fl'>10</span>, <span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fl'>11</span>:<span class='fl'>20</span>, <span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='fl'>2</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fl'>21</span>:<span class='fl'>30</span>, <span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>4</span>), <span class='fl'>3</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fl'>31</span>:<span class='fl'>40</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>4</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>E</span>[ <span class='fl'>31</span>:<span class='fl'>40</span>, <span class='fl'>2</span>, <span class='fl'>2</span>:<span class='fl'>4</span>, <span class='fl'>4</span> ] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>

<span class='co'># constraint on slope parameters, see Brandt (2012)</span>
<span class='no'>gammaconstr</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>( <span class='no'>gammaslope</span> ){
        <span class='no'>K</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>( <span class='no'>gammaslope</span>)
        <span class='no'>g1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>( <span class='no'>gammaslope</span>^<span class='fl'>2</span>  )
        <span class='no'>gammaslope.new</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>K</span>) / <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>g1</span>) * <span class='no'>gammaslope</span>
        <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>gammaslope.new</span>)
                    }
<span class='co'># estimate model</span>
<span class='no'>mod6</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.mml.3pl.html'>tam.mml.3pl</a></span>( <span class='no'>dat</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q2</span>, <span class='kw'>variance.fixed</span><span class='kw'>=</span><span class='no'>variance.fixed2</span>,
           <span class='kw'>skillspace</span><span class='kw'>=</span><span class='st'>"normal"</span>, <span class='kw'>userfct.gammaslope</span><span class='kw'>=</span><span class='no'>gammaconstr</span>, <span class='kw'>gammaslope.constr.Npars</span><span class='kw'>=</span><span class='fl'>1</span>,
           <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='no'>maxit</span>, <span class='kw'>QMC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>snodes</span><span class='kw'>=</span><span class='no'>snodes</span> ) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod6</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 18: Partial credit model with dimension-specific sum constraints</span>
<span class='co'>#             on item difficulties</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.Students</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"CDM"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.Students</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"sc"</span>,<span class='fl'>1</span>:<span class='fl'>4</span>), <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"mj"</span>,<span class='fl'>1</span>:<span class='fl'>4</span>) ) ]
<span class='co'># specify dimensions in Q-matrix</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>0</span>,  <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>2</span> )
<span class='no'>Q</span>[<span class='fl'>1</span>:<span class='fl'>4</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>Q</span>[<span class='fl'>5</span>:<span class='fl'>8</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># partial credit model with some constraint on item parameters</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"PCM2"</span>, <span class='kw'>constraint</span><span class='kw'>=</span><span class='st'>"items"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 19: Partial credit scoring: 0.5 points for partial credit items</span>
<span class='co'>#             and 1 point for dichotomous items</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.timssAusTwn.scored</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.timssAusTwn.scored</span>
<span class='co'># extrcat item response data</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[, <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"M03"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>) ) ]

<span class='co'># select items with do have maximum score of 2 (polytomous items)</span>
<span class='no'>ind</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>( <span class='no'>dat</span>,  <span class='fl'>2</span>, <span class='no'>max</span>, <span class='kw'>na.rm</span><span class='kw'>=</span><span class='fl'>TRUE</span> )<span class='kw'>==</span><span class='fl'>2</span> )
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>dat</span>)
<span class='co'># define Q-matrix with scoring variant</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='fl'>1</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>I</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>1</span> )
<span class='no'>Q</span>[ <span class='no'>ind</span>, <span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='fl'>.5</span>    <span class='co'># score of 0.5 for polyomous items</span>

<span class='co'># estimate model</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"PCM2"</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>nodes</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(-<span class='fl'>10</span>,<span class='fl'>10</span>,<span class='kw'>len</span><span class='kw'>=</span><span class='fl'>21</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 20: Specification of loading matrix in multidimensional model</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>)
<span class='kw pkg'>psych</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/psych/man/describe.html'>describe</a></span>(<span class='no'>data.gpcm</span>)
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>data.gpcm</span>

<span class='co'># define three dimensions and different loadings of item categories</span>
<span class='co'># on these dimensions in B loading matrix</span>
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>  <span class='co'># 3 items</span>
<span class='no'>D</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>  <span class='co'># 3 dimensions</span>
<span class='co'># define loading matrix B</span>
<span class='co'># 4 categories for each item (0,1,2,3)</span>
<span class='no'>B</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>( <span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>I</span>,<span class='fl'>4</span>,<span class='no'>D</span>) )
<span class='kw'>for</span> (<span class='no'>ii</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='no'>I</span>){
    <span class='no'>B</span>[ <span class='no'>ii</span>, <span class='fl'>1</span>:<span class='fl'>4</span>, <span class='fl'>1</span> ] <span class='kw'>&lt;-</span> <span class='fl'>0</span>:<span class='fl'>3</span>
    <span class='no'>B</span>[ <span class='no'>ii</span>, <span class='fl'>1</span>,<span class='fl'>2</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
    <span class='no'>B</span>[ <span class='no'>ii</span>, <span class='fl'>4</span>,<span class='fl'>3</span> ] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
            }
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>)
<span class='no'>B</span>[<span class='fl'>1</span>,,]
  <span class='co'>##   &gt; B[1,,]</span>
  <span class='co'>##        [,1] [,2] [,3]</span>
  <span class='co'>##   [1,]    0    1    0</span>
  <span class='co'>##   [2,]    1    0    0</span>
  <span class='co'>##   [3,]    2    0    0</span>
  <span class='co'>##   [4,]    3    0    1</span>
<span class='co'>#-- test run</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>resp</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='no'>B</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>1000</span>, <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>5</span>)  )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'># Same model with TAM::tam.mml.3pl instead</span>

<span class='no'>dim4</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>B</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>3</span>), <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(!(<span class='no'>x</span><span class='kw'>==</span><span class='fl'>0</span>))))
<span class='no'>E1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>B</span>), <span class='no'>dim4</span>))

<span class='no'>kkk</span> <span class='kw'>&lt;-</span> <span class='fl'>0</span>
<span class='kw'>for</span> (<span class='no'>iii</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>E1</span>)[<span class='fl'>1</span>])) {
    <span class='kw'>for</span> (<span class='no'>jjj</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>E1</span>)[<span class='fl'>3</span>])) {
        <span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(<span class='no'>B</span>[<span class='no'>iii</span>,, <span class='no'>jjj</span>] <span class='kw'>!=</span><span class='fl'>0</span>)) {
            <span class='no'>kkk</span> <span class='kw'>&lt;-</span> <span class='no'>kkk</span> + <span class='fl'>1</span>
            <span class='no'>E1</span>[<span class='no'>iii</span>,, <span class='no'>jjj</span>, <span class='no'>kkk</span>] <span class='kw'>&lt;-</span> <span class='no'>B</span>[<span class='no'>iii</span>,, <span class='no'>jjj</span>]
        }
    }
}
<span class='kw'>if</span> (<span class='no'>kkk</span> <span class='kw'>!=</span><span class='no'>dim4</span>) <span class='fu'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span>(<span class='st'>"Something went wrong in the loop, because 'kkk !=dim4'."</span>)

<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.mml.3pl.html'>tam.mml.3pl</a></span>(<span class='no'>resp</span>, <span class='kw'>E</span><span class='kw'>=</span><span class='no'>E1</span>, <span class='kw'>est.some.slopes</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>50</span>))
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)

<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span>(<span class='no'>mod1</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim3</span>, <span class='no'>mod2</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim3</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span>(<span class='no'>mod1</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim2</span>, <span class='no'>mod2</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim2</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span>(<span class='no'>mod1</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim1</span>, <span class='no'>mod2</span>$<span class='no'>person</span>$<span class='no'>EAP.Dim1</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span>(<span class='no'>mod1</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>, <span class='no'>mod2</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 21: Acceleration of EM algorithm | dichotomous data</span>
<span class='co'>#############################################################################</span>

<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>1000</span>      <span class='co'># number of persons</span>
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span>       <span class='co'># number of items</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>987</span>)
<span class='co'># simulate data according to the Rasch model</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sirt</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sirt/man/sim.raschtype.html'>sim.raschtype</a></span>( <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>), <span class='kw'>b</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(-<span class='fl'>2</span>,<span class='fl'>2</span>,<span class='kw'>len</span><span class='kw'>=</span><span class='no'>I</span>)  )
<span class='co'># estimate models</span>
<span class='no'>mod1n</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"none"</span>) )  <span class='co'># no acceler.</span>
<span class='no'>mod1y</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"Yu"</span>) )  <span class='co'># Yu acceler.</span>
<span class='no'>mod1r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"Ramsay"</span>) )  <span class='co'># Ramsay acceler.</span>
<span class='co'># compare number of iterations</span>
<span class='no'>mod1n</span>$<span class='no'>iter</span> ; <span class='no'>mod1y</span>$<span class='no'>iter</span> ; <span class='no'>mod1r</span>$<span class='no'>iter</span>
<span class='co'># log-likelihood values</span>
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod1n</span>); <span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod1y</span>) ; <span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod1r</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 22: Acceleration of EM algorithm | polytomous data</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.gpcm</span>

<span class='co'># no acceleration</span>
<span class='no'>mod1n</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>conv</span><span class='kw'>=</span><span class='fl'>1E-4</span>, <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"none"</span>) )
<span class='co'># Yu acceleration</span>
<span class='no'>mod1y</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>conv</span><span class='kw'>=</span><span class='fl'>1E-4</span>, <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"Yu"</span>) )
<span class='co'># Ramsay acceleration</span>
<span class='no'>mod1r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>,
                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>conv</span><span class='kw'>=</span><span class='fl'>1E-4</span>, <span class='kw'>acceleration</span><span class='kw'>=</span><span class='st'>"Ramsay"</span>) )
<span class='co'># number of iterations</span>
<span class='no'>mod1n</span>$<span class='no'>iter</span> ; <span class='no'>mod1y</span>$<span class='no'>iter</span> ; <span class='no'>mod1r</span>$<span class='no'>iter</span>

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 23: Multidimensional polytomous Rasch model in which</span>
<span class='co'>#             dimensions are defined by categories</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.Students</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"CDM"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.Students</span>[, <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>( <span class='st'>"act"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>data.Students</span>) ) ]

<span class='co'># define multidimensional model in which categories of item define dimensions</span>

<span class='co'># * Category 0 -&gt; loading of one on Dimension 0</span>
<span class='co'># * Category 1 -&gt; no loadings</span>
<span class='co'># * Category 2 -&gt; loading of one on Dimension 2</span>

<span class='co'># extract default design matrices</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>designMatrices</a></span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span> )
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='no'>res</span>$<span class='no'>A</span>
<span class='no'>B0</span> <span class='kw'>&lt;-</span> <span class='fl'>0</span>*<span class='no'>res</span>$<span class='no'>B</span>
<span class='co'># create design matrix B</span>
<span class='no'>B</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>( <span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>B0</span>)[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>) ], <span class='fl'>2</span>  ) )
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B0</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>2</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B0</span>)<span class='kw'>[[</span><span class='fl'>2</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>3</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='st'>"Dim0"</span>, <span class='st'>"Dim2"</span> )
<span class='no'>B</span>[,<span class='fl'>1</span>,<span class='fl'>1</span>]  <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>B</span>[,<span class='fl'>3</span>,<span class='fl'>2</span>]  <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='co'># estimate multdimensional Rasch model</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='no'>B</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>100</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'># alternative definition of B</span>
<span class='co'># * Category 1: negative loading on Dimension 1 and Dimension 2</span>
<span class='no'>B</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>( <span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>B0</span>)[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>) ], <span class='fl'>2</span>  ) )
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>1</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B0</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>2</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B0</span>)<span class='kw'>[[</span><span class='fl'>2</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span>(<span class='no'>B</span>)<span class='kw'>[[</span><span class='fl'>3</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>( <span class='st'>"Dim0"</span>, <span class='st'>"Dim2"</span> )
<span class='no'>B</span>[,<span class='fl'>1</span>, <span class='fl'>1</span>]  <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>B</span>[,<span class='fl'>3</span>, <span class='fl'>2</span>]  <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>B</span>[,<span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>)]  <span class='kw'>&lt;-</span> -<span class='fl'>1</span>

<span class='co'># estimate model</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A</span>, <span class='kw'>B</span><span class='kw'>=</span><span class='no'>B</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>( <span class='kw'>maxiter</span><span class='kw'>=</span><span class='fl'>100</span>) )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 24: Sum constraint on item-category parameters in partial credit model</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>,<span class='kw'>package</span><span class='kw'>=</span><span class='st'>"TAM"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.gpcm</span>

<span class='co'># check number of categories</span>
<span class='no'>c1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='tam.ctt.html'>tam.ctt3</a></span>(<span class='no'>dat</span>)

<span class='co'>#--- fit with PCM</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span> )
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='st'>"mod1"</span>)

<span class='co'>#--- fit with constraint on sum of categories</span>
<span class='co'>#** redefine design matrix</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='fl'>0</span>*<span class='no'>mod1</span>$<span class='no'>A</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='no'>A1</span>[,, - <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]]]
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>A1</span>)
<span class='no'>NP</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>A1</span>)<span class='kw'>[[</span><span class='fl'>3</span>]]
<span class='co'># define item category parameters</span>
<span class='no'>A1</span>[<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>3</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fl'>2</span>,<span class='fl'>2</span>,<span class='fl'>4</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>5</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>6</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fl'>3</span>,<span class='fl'>2</span>,<span class='fl'>7</span>] <span class='kw'>&lt;-</span> <span class='no'>A1</span>[<span class='fl'>3</span>,<span class='fl'>3</span>,<span class='fl'>8</span>] <span class='kw'>&lt;-</span> -<span class='fl'>1</span>
<span class='no'>A1</span>[<span class='fl'>3</span>,<span class='fl'>4</span>,<span class='fl'>1</span>:<span class='fl'>8</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># check definition</span>
<span class='no'>A1</span>[<span class='fl'>1</span>,,]
<span class='no'>A1</span>[<span class='fl'>2</span>,,]
<span class='no'>A1</span>[<span class='fl'>3</span>,,]

<span class='co'>#** estimate model</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml</span>( <span class='no'>dat</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>, <span class='kw'>beta.fixed</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod2</span>, <span class='kw'>file</span><span class='kw'>=</span><span class='st'>"mod2"</span>)

<span class='co'>#--- compare model fit</span>
<span class='fu'>IRT.compareModels</span>(<span class='no'>mod1</span>, <span class='no'>mod2</span> )  <span class='co'># -&gt; equivalent model fit</span>

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 25: Different GPCM parametrizations in IRT packages</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>TAM</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>mirt</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ltm</span>)

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.gpcm</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"TAM"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>data.gpcm</span>

<span class='co'>#*** TAM</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='no'>dat</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>)
<span class='co'>#*** mirt</span>
<span class='no'>mod2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mirt</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mirt/man/mirt.html'>mirt</a></span>(<span class='no'>dat</span>, <span class='fl'>1</span>, <span class='kw'>itemtype</span><span class='kw'>=</span><span class='st'>"gpcm"</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='co'>#*** ltm</span>
<span class='no'>mod3</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>ltm</span><span class='kw ns'>::</span><span class='fu'>gpcm</span>( <span class='no'>dat</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>) )
<span class='no'>mod3b</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>ltm</span><span class='kw ns'>::</span><span class='fu'>gpcm</span>( <span class='no'>dat</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span>), <span class='kw'>IRT.param</span><span class='kw'>=</span><span class='fl'>FALSE</span>)

<span class='co'>#-- comparison log likelihood</span>
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod1</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod2</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod3</span>)
<span class='fu'><a href='https://rdrr.io/r/stats/logLik.html'>logLik</a></span>(<span class='no'>mod3b</span>)

<span class='co'>#*** intercept parametrization (like in TAM)</span>

<span class='co'># TAM</span>
<span class='no'>mod1</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,<span class='fl'>1</span>]   <span class='co'># slope</span>
<span class='no'>mod1</span>$<span class='no'>AXsi</span>      <span class='co'># intercepts</span>
<span class='co'># mirt</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod2</span>)
<span class='co'># ltm</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod3b</span>, <span class='kw'>IRT.param</span><span class='kw'>=</span><span class='fl'>FALSE</span>)[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>,<span class='fl'>1</span>:<span class='fl'>3</span>)]

<span class='co'>#*** IRT parametrization</span>

<span class='co'># TAM</span>
<span class='no'>mod1</span>$<span class='no'>AXsi</span> / <span class='no'>mod1</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,<span class='fl'>1</span>]
<span class='co'># mirt</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod2</span>, <span class='kw'>IRTpars</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='co'># ltm</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='no'>mod3</span>)[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>,<span class='fl'>1</span>:<span class='fl'>3</span>)]

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 26: Differential item functioning in multdimensional models</span>
<span class='co'>#############################################################################</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>data.ex08</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"TAM"</span>)
<span class='no'>formulaA</span> <span class='kw'>&lt;-</span> ~ <span class='no'>item</span>+<span class='no'>female</span>+<span class='no'>item</span>*<span class='no'>female</span>
<span class='no'>resp</span> <span class='kw'>&lt;-</span> <span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"resp"</span>]]
<span class='no'>facets</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span>(<span class='no'>data.ex08</span><span class='kw'>[[</span><span class='st'>"facets"</span>]])

<span class='co'>#***  Model 8a: investigate gender DIF in undimensional model</span>
<span class='no'>mod8a</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.mfr</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>facets</span><span class='kw'>=</span><span class='no'>facets</span>, <span class='kw'>formulaA</span><span class='kw'>=</span><span class='no'>formulaA</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod8a</span>)

<span class='co'>#*** multidimensional 2PL Model</span>
<span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>
<span class='no'>Q</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>0</span>, <span class='kw'>dim</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>I</span>, <span class='fl'>3</span>))
<span class='no'>Q</span>[<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>1</span>:<span class='no'>I</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fl'>3</span>), <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>2</span>, <span class='fl'>3</span>), <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>3</span>, <span class='fl'>4</span>)))] <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>Q</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>resp</span>)
<span class='no'>mod3dim2pl</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>resp</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>,
                          <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>))

<span class='co'>#*** Combine both approaches</span>
<span class='no'>thisRows</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span>(<span class='st'>"-.*"</span>, <span class='st'>""</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>mod8a</span>$<span class='no'>resp</span>)) <span class='co'>#select item names</span>

<span class='co'>#*** uniform DIF (note irtmodel="2PL.groups" &amp; est.slopegroups)</span>
<span class='no'>mod3dim2pl_udiff</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>resp</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>A</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>[<span class='no'>thisRows</span>, ],
                               <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL.groups"</span>,
                               <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span>(<span class='no'>thisRows</span>)),
                               <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>))

<span class='co'>#*** non-uniform DIF (?); different slope parameters for each item administered to each group</span>
<span class='no'>mod3dim2pl_nudiff</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>resp</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>A</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q</span>[<span class='no'>thisRows</span>, ],
                                <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL"</span>, <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>))

<span class='co'>#*** check results</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>mod8a</span>$<span class='no'>xsi</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>mod3dim2pl_udiff</span>$<span class='no'>xsi</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod3dim2pl_nudiff</span>)

<span class='co'>#*** within item dimensionality (one item loads on two dimensions)</span>
<span class='no'>Q2</span> <span class='kw'>&lt;-</span> <span class='no'>Q</span>
<span class='no'>Q2</span>[<span class='fl'>4</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>

<span class='co'># uniform DIF (note irtmodel="2PL.groups" &amp; est.slopegroups)</span>
<span class='no'>mod3dim2pl_udiff2</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>(<span class='kw'>resp</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>resp</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>mod8a</span>$<span class='no'>A</span>, <span class='kw'>Q</span><span class='kw'>=</span><span class='no'>Q2</span>[<span class='no'>thisRows</span>, ],
                                <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"2PL.groups"</span>,
                                <span class='kw'>est.slopegroups</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span>(<span class='no'>thisRows</span>)),
                                <span class='kw'>control</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>snodes</span><span class='kw'>=</span><span class='fl'>2000</span>))
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>mod8a</span>$<span class='no'>xsi</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>mod3dim2pl_udiff2</span>$<span class='no'>xsi</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>mod3dim2pl_udiff2</span>$<span class='no'>xsi</span>)

<span class='co'>#############################################################################</span>
<span class='co'># EXAMPLE 27: IRT parameterization for generalized partial credit model (GPCM) in TAM</span>
<span class='co'>#############################################################################</span>

<span class='co'>#--- read item parameters</span>
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='kw pkg'>miceadds</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/miceadds/man/scan.vector.html'>scan.vec</a></span>(
<span class='st'>"0.19029 1.25309 0.51737 -1.77046 0.94803
  0.19407 1.22680 0.34986 -1.57666 1.29726
  -0.00888 1.07093 0.31662 -1.38755 1.14809
  -0.33810 1.08205 0.48490 -1.56696 0.79547
  -0.18866 0.99587 0.37880 -1.37468 0.81114"</span> ))
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='no'>pars</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>beta</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[,<span class='fl'>1</span>]
<span class='no'>alpha</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[,<span class='fl'>5</span>]
<span class='no'>tau</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[,<span class='fl'>2</span>:<span class='fl'>4</span>]

<span class='co'>#--- data simulation function for GPCM</span>
<span class='no'>sim_gpcm_irt_param</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>alpha</span>, <span class='no'>beta</span>, <span class='no'>tau</span>, <span class='no'>N</span>, <span class='no'>mu</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='no'>sigma</span><span class='kw'>=</span><span class='fl'>1</span>)
{
    <span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>N</span>, <span class='kw'>mean</span><span class='kw'>=</span><span class='no'>mu</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='no'>sigma</span>)
    <span class='no'>I</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>beta</span>)
    <span class='no'>K</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>tau</span>)
    <span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>I</span>)
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>dat</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"I"</span>,<span class='fl'>1</span>:<span class='no'>I</span>)
    <span class='kw'>for</span> (<span class='no'>ii</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='no'>I</span>){
        <span class='no'>probs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>K</span>+<span class='fl'>1</span>)
        <span class='kw'>for</span> (<span class='no'>kk</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='no'>K</span>){
            <span class='no'>probs</span>[,<span class='no'>kk</span>+<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>probs</span>[,<span class='no'>kk</span>] + <span class='no'>alpha</span>[<span class='no'>ii</span>]*( <span class='no'>theta</span> - <span class='no'>beta</span>[<span class='no'>ii</span>] - <span class='no'>tau</span>[<span class='no'>ii</span>,<span class='no'>kk</span>] )
        }
        <span class='no'>probs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='no'>probs</span>)
        <span class='no'>probs</span> <span class='kw'>&lt;-</span> <span class='no'>probs</span>/<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span>(<span class='no'>probs</span>)
        <span class='no'>rn</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='no'>N</span>)
        <span class='no'>cumprobs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>probs</span>,<span class='fl'>1</span>,<span class='no'>cumsum</span>))
        <span class='kw'>for</span> (<span class='no'>kk</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='no'>K</span>){
            <span class='no'>dat</span>[,<span class='no'>ii</span>] <span class='kw'>&lt;-</span> <span class='no'>dat</span>[,<span class='no'>ii</span>] + ( <span class='no'>rn</span> <span class='kw'>&gt;</span> <span class='no'>cumprobs</span>[,<span class='no'>kk</span>] )
        }
    }
    <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>dat</span>)
}

<span class='co'>#-- simulate data</span>
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fl'>20000</span>     <span class='co'># number of persons</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>98</span>)
<span class='no'>dat1</span> <span class='kw'>&lt;-</span> <span class='fu'>sim_gpcm_irt_param</span>(<span class='kw'>alpha</span><span class='kw'>=</span><span class='no'>alpha</span>, <span class='kw'>beta</span><span class='kw'>=</span><span class='no'>beta</span>, <span class='kw'>tau</span><span class='kw'>=</span><span class='no'>tau</span>, <span class='kw'>N</span><span class='kw'>=</span><span class='no'>N</span>, <span class='kw'>mu</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>sigma</span><span class='kw'>=</span><span class='fl'>1</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>dat1</span>)

<span class='co'>#* generate design matrix for IRT parameterization</span>
<span class='no'>A1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'><a href='designMatrices.html'>.A.PCM2</a></span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat1</span>)

<span class='co'>#- estimate GPCM model</span>
<span class='no'>mod1</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>TAM</span><span class='kw ns'>::</span><span class='fu'>tam.mml.2pl</span>( <span class='kw'>resp</span><span class='kw'>=</span><span class='no'>dat1</span>, <span class='kw'>irtmodel</span><span class='kw'>=</span><span class='st'>"GPCM"</span>, <span class='kw'>A</span><span class='kw'>=</span><span class='no'>A1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mod1</span>)

<span class='co'># compare true and estimated slope estimates (alpha)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='no'>alpha</span>, <span class='no'>mod1</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,] )

<span class='co'># compare true and estimated item difficulties (beta)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='no'>beta</span>, <span class='no'>mod1</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>[<span class='fl'>1</span>:<span class='fl'>5</span>] / <span class='no'>mod1</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,<span class='fl'>1</span>] )

<span class='co'># compare true and estimated tau parameters</span>
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>( <span class='no'>tau</span>[,-<span class='fl'>3</span>], <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>( <span class='no'>mod1</span>$<span class='no'>xsi</span>$<span class='no'>xsi</span>[-<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>5</span>)], <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>TRUE</span> ) / <span class='no'>mod1</span>$<span class='no'>B</span>[,<span class='fl'>2</span>,<span class='fl'>1</span>] )
}</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Robitzsch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


